<!-- 
    Este arquivo HTML e JavaScript contém a implementação completa dos widgets de acessibilidade e flutuantes
    que aparecem no lado direito da tela.

    - O componente principal é o '.side-widgets-container'.
    - Inclui o botão de acessibilidade, que abre e fecha o menu lateral.
    - Inclui o menu lateral de acessibilidade com várias opções (Contraste, Saturação, Tamanho da Fonte, etc.).
    - Inclui os botões flutuantes de "Voltar ao Topo" e "Libras".
    - A lógica JavaScript gerencia as classes CSS para ativar e desativar as funcionalidades.
-->

<!-- Widgets Laterais (Acessibilidade e Flutuantes) -->
<div class="side-widgets-container">
    <!-- Botão de Acessibilidade -->
    <div class="accessibility-widget">
        <button id="accessibility-btn" class="rounded-l-lg shadow-lg" aria-label="Abrir menu de acessibilidade">
            <i class="fa-solid fa-wheelchair text-2xl"></i>
        </button>
    </div>
    <!-- Botões Flutuantes -->
    <div class="floating-buttons flex flex-col gap-2">
        <button id="back-to-top-btn" class="is-hidden" aria-label="Voltar para o topo da página">
            <i class="fa-solid fa-arrow-up text-xl"></i>
        </button>
        <a href="https://www.vlibras.gov.br/" target="_blank" id="vlibras-btn" aria-label="Acessar VLibras">
            <button class="w-10 h-10 rounded-full flex items-center justify-center">
                <i class="fa-solid fa-hands text-xl"></i>
            </button>
        </a>
    </div>
</div>

<!-- Menu Lateral de Acessibilidade -->
<div id="accessibility-menu" class="hidden md:flex flex-col bg-white shadow-xl">
    <div class="p-6 border-b border-gray-200 flex justify-between items-center">
        <h3 class="text-xl font-bold text-gray-800">Acessibilidade</h3>
        <button id="close-accessibility-menu" class="text-gray-500 hover:text-gray-800 transition-colors" aria-label="Fechar menu de acessibilidade">
            <i class="fa-solid fa-xmark text-2xl"></i>
        </button>
    </div>
    <div class="flex-grow p-6 space-y-6 overflow-y-auto">
        
        <!-- Contraste -->
        <div class="acc-feature" data-setting="contrast">
            <h4 class="font-semibold text-gray-700 mb-2">Contraste</h4>
            <div class="flex gap-2">
                <button data-value="normal" class="acc-option active">Normal</button>
                <button data-value="dark" class="acc-option">Escuro</button>
                <button data-value="light" class="acc-option">Claro</button>
                <button data-value="inverted" class="acc-option">Invertido</button>
            </div>
        </div>

        <!-- Saturação -->
        <div class="acc-feature" data-setting="saturation">
            <h4 class="font-semibold text-gray-700 mb-2">Saturação</h4>
            <div class="flex gap-2">
                <button data-value="normal" class="acc-option active">Normal</button>
                <button data-value="low" class="acc-option">Baixa</button>
                <button data-value="high" class="acc-option">Alta</button>
                <button data-value="mono" class="acc-option">Monocromático</button>
            </div>
        </div>

        <!-- Tamanho da Fonte -->
        <div class="acc-feature" data-setting="fontsize">
            <h4 class="font-semibold text-gray-700 mb-2">Tamanho da Fonte</h4>
            <div class="flex gap-2 items-center">
                <button data-value="reset" class="acc-option text-base">A</button>
                <button data-value="increase" class="acc-option text-lg">A+</button>
                <button data-value="decrease" class="acc-option text-sm">A-</button>
            </div>
        </div>
        
        <!-- Tipo de Fonte -->
        <div class="acc-feature" data-setting="fontfamily">
            <h4 class="font-semibold text-gray-700 mb-2">Tipo de Fonte</h4>
            <div class="flex gap-2">
                <button data-value="normal" class="acc-option active">Padrão</button>
                <button data-value="serif" class="acc-option font-serif">Serif</button>
            </div>
        </div>

        <!-- Links Destacados -->
        <div class="acc-feature" data-setting="links">
            <h4 class="font-semibold text-gray-700 mb-2">Links Destacados</h4>
            <div class="flex gap-2">
                <button data-value="off" class="acc-option active">Desligado</button>
                <button data-value="on" class="acc-option">Ligado</button>
            </div>
        </div>

        <!-- Espaçamento de Texto -->
        <div class="acc-feature" data-setting="textspacing">
            <h4 class="font-semibold text-gray-700 mb-2">Espaçamento de Texto</h4>
            <div class="flex gap-2 items-center">
                <button data-value="reset" class="acc-option text-base tracking-normal">Normal</button>
                <button data-value="increase" class="acc-option text-lg tracking-wide">Amplo</button>
                <button data-value="decrease" class="acc-option text-sm tracking-tighter">Reduzido</button>
            </div>
        </div>

        <!-- Máscara de Leitura -->
        <div class="acc-feature" data-setting="readingmask">
            <h4 class="font-semibold text-gray-700 mb-2">Máscara de Leitura</h4>
            <div class="flex gap-2">
                <button data-value="off" class="acc-option active">Desligado</button>
                <button data-value="on" class="acc-option">Ligado</button>
            </div>
        </div>

        <!-- Guia de Leitura -->
        <div class="acc-feature" data-setting="readingguide">
            <h4 class="font-semibold text-gray-700 mb-2">Guia de Leitura</h4>
            <div class="flex gap-2">
                <button data-value="off" class="acc-option active">Desligado</button>
                <button data-value="on" class="acc-option">Ligado</button>
            </div>
        </div>
        
    </div>

    <div class="p-6 border-t border-gray-200">
        <button id="reset-accessibility" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-md transition-colors">
            Redefinir
        </button>
    </div>
</div>

<!-- Máscara e Guia de Leitura -->
<div id="reading-mask" class="hidden"></div>
<div id="reading-guide" class="hidden"></div>

<script>
    // --- LÓGICA DE WIDGETS DE ACESSIBILIDADE E BOTÕES FLUTUANTES ---
    document.addEventListener('DOMContentLoaded', () => {

        // --- Botão "Voltar ao Topo" ---
        const backToTopBtn = document.getElementById('back-to-top-btn');
        if (backToTopBtn) {
            const toggleBackToTopButton = () => {
                // Mostra o botão quando o scrollY é maior que 300px
                if (window.scrollY > 300) {
                    backToTopBtn.classList.remove('is-hidden');
                } else {
                    backToTopBtn.classList.add('is-hidden');
                }
            };
            
            // Verifica o estado inicial ao carregar a página e adiciona o listener de scroll
            toggleBackToTopButton();
            window.addEventListener('scroll', toggleBackToTopButton);

            // Adiciona o listener para o evento de clique
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        // --- Acessibilidade (Menu Lateral) ---
        const accessibilityBtn = document.getElementById('accessibility-btn');
        const accessibilityMenu = document.getElementById('accessibility-menu');
        const closeAccessibilityBtn = document.getElementById('close-accessibility-menu');
        const resetAccessibilityBtn = document.getElementById('reset-accessibility');
        const body = document.body;

        const ACCESSIBILITY_STATE_KEY = 'accessibilityState';

        // Estado inicial de acessibilidade
        const defaultState = {
            contrast: 'normal',
            saturation: 'normal',
            fontsize: 16,
            fontfamily: 'normal',
            links: 'off',
            textspacing: 'normal',
            readingmask: 'off',
            readingguide: 'off'
        };

        let currentState = {};

        const applyState = () => {
            // Remove todas as classes de contraste, saturação, links e fonte
            body.classList.remove('contrast-dark', 'contrast-light', 'contrast-inverted', 
                                'saturation-low', 'saturation-high', 'saturation-mono',
                                'links-highlighted', 'font-serif');
            
            // Remove estilos inline de espaçamento e tamanho da fonte
            body.style.letterSpacing = '';
            body.style.wordSpacing = '';
            body.style.lineHeight = '';
            body.style.fontSize = '';
            
            // Remove máscaras
            document.getElementById('reading-mask').classList.add('hidden');
            document.getElementById('reading-guide').classList.add('hidden');
            
            // Aplica as classes e estilos baseados no estado atual
            if (currentState.contrast !== 'normal') {
                body.classList.add(`contrast-${currentState.contrast}`);
            }
            if (currentState.saturation !== 'normal') {
                body.classList.add(`saturation-${currentState.saturation}`);
            }
            if (currentState.fontfamily === 'serif') {
                body.classList.add('font-serif');
            }
            if (currentState.links === 'on') {
                body.classList.add('links-highlighted');
            }
            if (currentState.textspacing !== 'normal') {
                if (currentState.textspacing === 'increase') {
                    body.style.letterSpacing = '0.15em';
                    body.style.wordSpacing = '0.2em';
                    body.style.lineHeight = '1.8';
                } else if (currentState.textspacing === 'decrease') {
                    body.style.letterSpacing = '-0.05em';
                    body.style.wordSpacing = '-0.05em';
                    body.style.lineHeight = '1.2';
                }
            }
            if (currentState.readingmask === 'on') {
                document.getElementById('reading-mask').classList.remove('hidden');
            }
            if (currentState.readingguide === 'on') {
                document.getElementById('reading-guide').classList.remove('hidden');
            }
            
            // Aplica o tamanho da fonte
            body.style.fontSize = `${currentState.fontsize}px`;

            // Salva o estado no localStorage
            localStorage.setItem(ACCESSIBILITY_STATE_KEY, JSON.stringify(currentState));
            
            updateUI();
        };

        const updateUI = () => {
            document.querySelectorAll('.acc-option').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.acc-feature').forEach(feature => {
                feature.classList.remove('active');
            });

            // Atualiza o estado da UI para refletir o currentState
            for (const setting in currentState) {
                if (setting === 'fontsize' || setting === 'textspacing') continue;
                
                const featureContainer = document.querySelector(`.acc-feature[data-setting="${setting}"]`);
                const activeBtn = document.querySelector(`.acc-option[data-setting="${setting}"][data-value="${currentState[setting]}"]`);
                
                if (activeBtn) {
                    activeBtn.classList.add('active');
                    if (featureContainer) {
                        featureContainer.classList.add('active');
                    }
                }
            }
        };

        const loadState = () => {
            const savedState = localStorage.getItem(ACCESSIBILITY_STATE_KEY);
            if (savedState) {
                currentState = JSON.parse(savedState);
            } else {
                currentState = { ...defaultState };
            }
            applyState();
        };

        // Eventos de clique para as opções do menu
        document.querySelectorAll('.acc-option').forEach(btn => {
            btn.addEventListener('click', () => {
                const setting = btn.closest('.acc-feature').dataset.setting;
                const value = btn.dataset.value;

                if (setting === 'fontsize') {
                    if (value === 'increase') {
                        currentState.fontsize += 2;
                    } else if (value === 'decrease') {
                        currentState.fontsize -= 2;
                    } else if (value === 'reset') {
                        currentState.fontsize = defaultState.fontsize;
                    }
                } else {
                    currentState[setting] = value;
                }
                applyState();
            });
        });

        // Eventos de clique nos botões do menu
        accessibilityBtn.addEventListener('click', () => {
            accessibilityMenu.classList.remove('hidden');
            setTimeout(() => accessibilityMenu.classList.add('open'), 10);
            document.body.style.overflow = 'hidden';
        });

        closeAccessibilityBtn.addEventListener('click', () => {
            accessibilityMenu.classList.remove('open');
            setTimeout(() => accessibilityMenu.classList.add('hidden'), 300);
            document.body.style.overflow = '';
        });

        resetAccessibilityBtn.addEventListener('click', () => {
            localStorage.removeItem(ACCESSIBILITY_STATE_KEY);
            currentState = { ...defaultState };
            applyState();
        });

        // Lógica para o guia de leitura (Reading Guide)
        const readingGuide = document.getElementById('reading-guide');
        document.addEventListener('mousemove', (e) => {
            if (currentState.readingguide === 'on') {
                const guideHeight = 50; // Altura da guia
                const windowHeight = window.innerHeight;
                const mouseY = e.clientY;
                
                const topOffset = mouseY - (guideHeight / 2);
                readingGuide.style.top = `${topOffset}px`;
                readingGuide.style.height = `${guideHeight}px`;
            }
        });

        // Carrega o estado de acessibilidade ao iniciar
        loadState();
    });
</script>
