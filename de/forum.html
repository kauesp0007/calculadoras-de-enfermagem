<!DOCTYPE html>
<html lang="de">
<head>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="/menu-global.html" as="fetch" crossorigin>
    <link rel="preload" href="/global-body-elements.html" as="fetch" crossorigin>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Forum | Krankenpflege-Rechner</title>
    
    <meta name="description" content="Nehmen Sie an Diskussionen teil und teilen Sie Wissen in unserem Krankenpflege-Forum. Stellen Sie Fragen und antworten Sie anderen Benutzern." />
    <meta name="author" content="Krankenpflege-Rechner" />
    <meta name="robots" content="index, follow" />
    <!-- Startseite DE -->
<link rel="canonical" href="https://www.calculadorasdeenfermagem.com.br/de/forum.html" />
  <link rel="alternate" hreflang="pt-br" href="https://www.calculadorasdeenfermagem.com.br/forum.html" />
  <link rel="alternate" hreflang="de" href="https://www.calculadorasdeenfermagem.com.br/de/forum.html" />
  <link rel="alternate" hreflang="en" href="https://www.calculadorasdeenfermagem.com.br/en/forum.html" />
  <link rel="alternate" hreflang="es" href="https://www.calculadorasdeenfermagem.com.br/es/forum.html" />
  <link rel="alternate" hreflang="x-default" href="https://www.calculadorasdeenfermagem.com.br/forum.html" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/global-styles.css">
  <style>
      :root {
          --primary-blue: #1A3E74;
          --dark-blue: #0E2340;
          --accent-red: #D9534F;
      }
      .bg-primary-blue { background-color: var(--primary-blue); }
      .text-primary-blue { color: var(--primary-blue); }
      .hover:bg-dark-blue:hover { background-color: var(--dark-blue); }
      .post-container:nth-child(even) {
        background-color: #f7f7f7;
      }
      .post-container {
        border-left: 5px solid var(--primary-blue);
      }
      /* Estilos para o resultado da calculadora (semelhante ao global-styles) */
      .standard-result-box {
          margin-top: 1.5rem;
          padding: 1.5rem;
          background-color: #e6f0ff; /* Light blue/grey */
          border: 1px solid #cce0ff;
          border-radius: 0.5rem;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
          text-align: center;
          font-family: 'Inter', sans-serif;
      }
  </style>

    <!-- Firebase SDK (Configuração Global - Nível de Produção) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-50 font-['Inter']">

    <!-- Carregar o Menu Global e Elementos do Corpo -->
    <div id="menu-global-container"></div>
    <div id="global-body-elements-container"></div>
    <!-- Fim Carregamento Global -->

    <div class="main-content-wrapper container mx-auto p-4 md:p-8 pt-20">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-black text-primary-blue mb-2">Krankenpflege-Forum</h1>
            <p class="text-gray-600 mb-6">Ein Ort, um Wissen auszutauschen, Fragen zu stellen und anderen Fachleuten zu helfen.</p>
        </header>

        <main class="max-w-4xl mx-auto">
            
            <!-- Formulário de Nova Postagem -->
            <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-200">
                <h2 class="text-2xl font-semibold text-primary-blue mb-4">Neuen Beitrag erstellen</h2>
                <form id="newPostForm">
                    <div class="mb-4">
                        <label for="name" class="block text-sm font-medium text-gray-700">Ihr Name / Benutzername:</label>
                        <input type="text" id="name" name="name" required placeholder="Ihr Name oder Benutzername" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-blue focus:ring-primary-blue sm:text-sm p-2">
                    </div>
                    <div>
                        <label for="postText" class="block text-sm font-medium text-gray-700 mt-4">Ihr Beitrag:</label>
                        <textarea id="postText" name="postText" rows="4" required placeholder="Schreiben Sie hier Ihre Frage oder Ihren Kommentar..." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-blue focus:ring-primary-blue sm:text-sm p-2"></textarea>
                    </div>
                    <button type="submit" class="w-full mt-4 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-blue hover:bg-dark-blue focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-blue transition duration-150 ease-in-out">Veröffentlichen</button>
                </form>
            </div>

            <!-- Seção de Postagens Recentes -->
            <div class="posts-section">
                <h2 class="text-2xl font-semibold text-primary-blue mt-8 mb-4">Neueste Beiträge</h2>
                <div id="postsContainer" class="space-y-4">
                    <!-- Posts serão carregados aqui pelo JavaScript -->
                    <p class="text-center text-gray-500" id="loadingMessage">Beiträge werden geladen...</p>
                </div>
            </div>
            
        </main>
    </div>

    <button id="backToTopBtn" title="Voltar ao Topo" class="fixed bottom-4 right-4 bg-primary-blue text-white p-3 rounded-full shadow-lg hover:bg-dark-blue transition duration-300 z-50" aria-label="Voltar ao Topo">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>
    
    
    <script src="https://vlibras.gov.br/app/vlibras-plugin.js" defer></script>
    <script src="global-scripts.js" async defer></script>
    
    <script>
        // Use os códigos globais de Firebase, se definidos
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;

        // Função de formatação de data/hora
        function formatDateTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('de-DE', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Inicialização do Firebase e Lógica do Fórum
        document.addEventListener('DOMContentLoaded', function() {
            const postsContainer = document.getElementById('postsContainer');
            const newPostForm = document.getElementById('newPostForm');
            const loadingMessage = document.getElementById('loadingMessage');

            if (!firebaseConfig) {
                postsContainer.innerHTML = '<p class="text-center text-red-600">Fehler: Firebase-Konfiguration nicht verfügbar. Die Forum-Funktion ist deaktiviert.</p>';
                return;
            }

            // Inicializar Firebase
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            
            // Referência ao banco de dados e à coleção de posts
            const database = firebase.database();
            // Caminho: /artifacts/{appId}/public/data/forum_posts
            const postsRef = database.ref(`artifacts/${appId}/public/data/forum_posts`).orderByChild('timestamp');

            // Lógica para o botão "Voltar ao Topo"
            const backToTopBtn = document.getElementById('backToTopBtn');
            if (backToTopBtn) {
                window.addEventListener('scroll', () => {
                    backToTopBtn.style.display = (window.scrollY > 200) ? 'block' : 'none';
                });
                backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            }
            
            // Inicializa o VLibras se o script for carregado
            if (typeof VLibras !== 'undefined') {
                new VLibras.Widget('https://vlibras.gov.br/app');
            }


            // Tratamento do Formulário de Nova Postagem
            newPostForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const nameInput = document.getElementById('name');
                const postTextInput = document.getElementById('postText');
                
                const name = nameInput.value.trim();
                const postText = postTextInput.value.trim();

                if (!name || !postText) {
                    // O atributo required do HTML já deve lidar com isso, mas por segurança.
                    // alert('Bitte geben Sie Ihren Namen und Ihren Beitragstext ein.');
                    return;
                }

                const newPostKey = postsRef.push().key;

                const postData = {
                    name: name,
                    postText: postText,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };

                // Salvar postagem no Firebase
                firebase.database().ref(`artifacts/${appId}/public/data/forum_posts/${newPostKey}`).set(postData)
                .then(() => {
                    newPostForm.reset();
                }).catch(error => {
                    console.error("Fehler beim Speichern des Beitrags:", error);
                    // alert('Beim Speichern des Beitrags ist ein Fehler aufgetreten.');
                });
            });

            // Escuta por novas postagens e as exibe na página
            postsRef.on('value', function(snapshot) {
                // Limpa postsContainer e esconde a mensagem de carregamento
                postsContainer.innerHTML = '';
                loadingMessage.style.display = 'none';

                if (snapshot.exists()) {
                    const posts = [];
                    snapshot.forEach(childSnapshot => {
                        posts.push(childSnapshot.val());
                    });
                    
                    // Reverte a ordem para exibir o mais recente primeiro (ordem decrescente de timestamp)
                    posts.reverse().forEach(post => {
                        const postElement = document.createElement('div');
                        postElement.className = "post-container p-4 bg-white rounded-lg shadow-md";
                        postElement.innerHTML = `
                            <div class="flex justify-between items-center mb-2">
                                <p class="font-bold text-lg text-primary-blue">${post.name}</p>
                                <p class="text-sm text-gray-500">${formatDateTime(post.timestamp)}</p>
                            </div>
                            <p class="text-gray-700">${post.postText}</p>
                        `;
                        postsContainer.appendChild(postElement);
                    });

                } else {
                    postsContainer.innerHTML = '<p class="text-center text-gray-500">Es gibt noch keine Beiträge. Seien Sie der Erste, der einen Beitrag veröffentlicht!</p>';
                }
            }, (error) => {
                 console.error("Fehler beim Abrufen von Beiträgen:", error);
                 postsContainer.innerHTML = '<p class="text-center text-red-600">Fehler beim Laden der Beiträge.</p>';
            });
        });
    </script>


<script type="text/javascript">
/* Código AdTerra se mantêm */
atOptions = {
	'key' : '1e009bba81deb2bc366b3c4ac030f6be',
	'format' : 'iframe',
	'height' : 90,
	'width' : 728,
	'params' : {}
};
</script>

<script src="/lang-selector.js" defer></script>
<div id="adterra-banner-container" style="min-height: 90px; width: 100%; display: flex; justify-content: center; align-items: center;">
    <script type="text/javascript" src="//www.topcreativeformat.com/1e009bba81deb2bc366b3c4ac030f6be/invoke.js"></script>
</div>
</body>
</html>
