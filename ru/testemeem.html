<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Мини-когнитивный тест - МКТ</title>
    <!-- Добавлена библиотека иконок (Font Awesome) для иконки кнопки PDF -->
    <link
      rel="preload"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript
      ><link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    /></noscript>

    <style>
      /* Глобальные стили */
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        background-color: #f9fafb;
        color: #333;
        line-height: 1.6;
        margin: 0;
        padding: 0;
        /* Обеспечивает пространство для плавающей кнопки */
        padding-bottom: 120px;
      }

      .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border: 1px solid #e5e7eb;
      }

      /* Заголовок */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #1a3e74; /* Цвет вашего сайта */
        padding-bottom: 15px;
        margin-bottom: 20px;
        page-break-inside: avoid; /* Избегать разрыва в заголовке */
      }

      .header h1 {
        font-size: 28px;
        font-weight: 900;
        color: #1a3e74;
        margin: 0;
      }

      .header .logo {
        max-width: 100px;
        height: auto;
        border-radius: 8px;
      }

      /* Информация о пациенте */
      .patient-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 25px;
        padding: 15px;
        background-color: #fdfdfd;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        page-break-inside: avoid; /* Избегать разрыва здесь */
      }

      .patient-info div {
        font-size: 14px;
      }

      .patient-info label {
        font-weight: 600;
        color: #555;
        display: block;
        margin-bottom: 2px;
      }

      .patient-info span {
        display: block;
        min-height: 20px;
        border-bottom: 1px dotted #ccc;
      }

      /* Корректировка для полной строки даты, если она нечетная */
      .patient-info div:last-child:nth-child(odd) {
        grid-column: 1 / -1;
      }

      /* Стиль критериев (Основан на вашем meem.html) */
      .criterion-card {
        background-color: #fff;
        border: 1px solid #d1d5db;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
        page-break-inside: avoid; /* Пытается избежать разрыва карточек */
      }

      .criterion-title {
        font-size: 18px;
        font-weight: 700;
        color: #1a3e74;
        margin-bottom: 12px;
        text-align: left; /* Стандарт, запрошенный */
      }

      .criterion-card p,
      .criterion-card ul {
        margin: 0 0 10px 0;
        padding-left: 0;
        font-size: 15px;
      }

      .criterion-card li {
        list-style-type: none;
        position: relative;
        padding-left: 20px;
        margin-bottom: 5px;
      }

      .criterion-card li::before {
        content: "•";
        position: absolute;
        left: 0;
        color: #1fa4e5; /* Цвет вашего сайта */
        font-weight: bold;
      }

      .criterion-card .instruction {
        font-style: italic;
        color: #666;
        font-size: 14px;
        border-left: 3px solid #1fa4e5;
        padding-left: 10px;
        margin-top: 10px;
      }

      .score-box {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        border-top: 1px solid #eee;
        padding-top: 15px;
        margin-top: 15px;
      }

      .score-box strong {
        font-size: 14px;
        color: #333;
        margin-right: 10px;
      }

      .score-box .score-input {
        width: 70px;
        padding: 5px 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
        text-align: center;
      }

      /* Рисунок (Пентагоны) */
      .pentagon-container {
        text-align: center;
        margin: 15px 0;
      }

      .pentagon-container img {
        max-width: 250px; /* При необходимости скорректируйте размер */
        height: auto;
      }

      /* Оценка баллов */
      .scoring-section {
        padding: 20px;
        background-color: #fdfdfd;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-top: 25px;
        page-break-inside: avoid; /* Пытается избежать разрыва этого раздела */
      }

      .scoring-section h3 {
        margin-top: 0;
        color: #1a3e74;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
      }

      .scoring-section table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      .scoring-section th,
      .scoring-section td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }

      .scoring-section th {
        background-color: #f4f4f4;
        font-weight: 600;
      }

      /* Блок комментариев */
      .comments-box {
        margin-top: 25px;
        page-break-inside: avoid; /* Пытается избежать разрыва этого блока */
      }

      .comments-box h3 {
        font-size: 18px;
        font-weight: 700;
        color: #1a3e74;
        margin-bottom: 10px;
      }

      .comments-box textarea {
        width: 100%;
        height: 150px;
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 10px;
        font-family: inherit;
        font-size: 14px;
        line-height: 1.8;
        /* Трюк для линеек */
        background-image: linear-gradient(#eee 0.1em, transparent 0.1em);
        background-size: 100% 1.8em;
        background-attachment: local;
        box-sizing: border-box; /* Гарантирует, что padding не нарушит макет */
      }

      /* Подвал */
      .footer {
        margin-top: 30px;
        padding-top: 15px;
        border-top: 1px solid #e5e7eb;
        font-size: 12px;
        color: #777;
        text-align: center;
        page-break-inside: avoid; /* Пытается сохранить подвал вместе */
      }

      .footer p {
        margin: 0;
      }

      /* --- Плавающая кнопка PDF --- */
      .pdf-download-button {
        position: fixed;
        bottom: 25px;
        right: 25px;
        background-color: #1a3e74; /* Основной цвет сайта */
        color: #fff;
        border: none;
        border-radius: 12px;
        padding: 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        cursor: pointer;
        z-index: 1000;
        width: 160px; /* Ширина карточки */
        text-align: center;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
      }

      .pdf-download-button:hover {
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
        transform: translateY(-4px); /* Эффект "покачивания" */
      }

      .pdf-download-button .pdf-icon {
        font-size: 2.5rem; /* Большая иконка */
        margin-bottom: 0.5rem;
      }

      .pdf-download-button .pdf-text {
        font-size: 1rem;
        font-weight: 600;
        line-height: 1.3;
      }

      /* --- Конец плавающей кнопки --- */

      /* Печать */
      @media print {
        body {
          background-color: #fff;
          font-size: 12pt;
          padding-bottom: 0; /* Удаляет padding при печати */
        }
        .container {
          box-shadow: none;
          border: none;
          padding: 0;
          margin: 0;
          max-width: 100%;
        }
        .criterion-card {
          box-shadow: none;
          border: 1px solid #ccc;
        }
        .comments-box textarea {
          border: 1px solid #999;
          background-image: linear-gradient(#ddd 0.1em, transparent 0.1em);
        }
        .score-input {
          border: 1px solid #999;
        }
        .patient-info {
          background-color: #fff;
        }
        /* Скрывает кнопку PDF при печати */
        .pdf-download-button {
          display: none;
        }
      }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700&family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9472305505608641"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="container" id="relatorio-meem">
      <div class="header">
        <h1>Мини-когнитивный тест - МКТ</h1>

        <img
          src="icondoc.webp"
          alt="Логотип Калькуляторы сестринского дела"
          class="logo"
        />
      </div>

      <div class="patient-info">
        <div><label>Имя пациента:</label><span></span></div>
        <div><label>Дата рождения:</label><span></span></div>
        <div><label>Возраст:</label><span></span></div>
        <div><label>Имя матери:</label><span></span></div>
        <div><label>Образование:</label><span></span></div>
        <div><label>Пол:</label><span></span></div>
        <div><label>Сопутствующие заболевания:</label><span></span></div>
        <div><label>Направляющий специалист:</label><span></span></div>
        <div><label>Дата:</label><span></span></div>
      </div>

      <!-- Начало шкалы МКТ -->

      <div class="criterion-card">
        <h2 class="criterion-title">
          1. Временная ориентация (Макс: 5 баллов)
        </h2>
        <p class="instruction">
          Спросить: "Какой (год / месяц / день месяца / день недели) сейчас?
          Который час (примерно)?"
        </p>
        <ul>
          <li>Год</li>
          <li>Месяц</li>
          <li>День месяца</li>
          <li>День недели</li>
          <li>Приблизительное время</li>
        </ul>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="5" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          2. Пространственная ориентация (Макс: 5 баллов)
        </h2>
        <p class="instruction">
          Спросить: "Где мы находимся? (Какое это место / улица / район / город
          / область?)"
        </p>
        <ul>
          <li>Место (например: дом, кабинет)</li>
          <li>Улица</li>
          <li>Район</li>
          <li>Город</li>
          <li>Область</li>
        </ul>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="5" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">3. Запоминание (Макс: 3 балла)</h2>
        <p class="instruction">
          "Скажу 3 слова. Повторите их для меня: ВАЗА, МАШИНА, КИРПИЧ". (1 балл
          за правильное повторение при первой попытке).
        </p>
        <ul>
          <li>Слово 1 (Ваза)</li>
          <li>Слово 2 (Машина)</li>
          <li>Слово 3 (Кирпич)</li>
        </ul>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="3" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">4. Внимание и счет (Макс: 5 баллов)</h2>
        <p class="instruction">
          Выберите ОДИН из вариантов: <br />А) "Вычтите 7 из 100, продолжайте
          вычитать 7 из результата, 5 раз." (93, 86, 79, 72, 65) <br />Б)
          "Правильно напишите слово МИР наоборот." (Р-И-М)
        </p>
        <ul>
          <li>Расчет 1 (или буква 1)</li>
          <li>Расчет 2 (или буква 2)</li>
          <li>Расчет 3 (или буква 3)</li>
          <li>Расчет 4 (или буква 4)</li>
          <li>Расчет 5 (или буква 5)</li>
        </ul>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="5" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          5. Память / Воспроизведение (Макс: 3 балла)
        </h2>
        <p class="instruction">
          "Какие 3 слова я просил вас повторить только что?" (Ваза, Машина,
          Кирпич).
        </p>
        <ul>
          <li>Слово 1 (Ваза)</li>
          <li>Слово 2 (Машина)</li>
          <li>Слово 3 (Кирпич)</li>
        </ul>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="3" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">6. Язык - Называние (Макс: 2 балла)</h2>
        <p class="instruction">
          Покажите 2 предмета (например: часы и ручка) и спросите название
          каждого.
        </p>
        <ul>
          <li>Предмет 1 (Часы)</li>
          <li>Предмет 2 (Ручка)</li>
        </ul>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="2" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">7. Язык - Повторение (Макс: 1 балл)</h2>
        <p class="instruction">
          Попросите пациента повторить фразу: "НИ ЗДЕСЬ, НИ ТАМ, НИ СЕЙЧАС".
          (Только одна попытка).
        </p>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">8. Язык - Команда (Макс: 3 балла)</h2>
        <p class="instruction">
          "Выполните эту команду в 3 этапа: <br />1. Возьмите этот лист бумаги
          правой рукой. <br />2. Сложите его пополам. <br />3. Положите его на
          стол."
        </p>
        <ul>
          <li>Этап 1 (Правая рука)</li>
          <li>Этап 2 (Сложить пополам)</li>
          <li>Этап 3 (Положить на стол)</li>
        </ul>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="3" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">9. Язык - Чтение (Макс: 1 балл)</h2>
        <p class="instruction">
          Дайте лист бумаги с написанной фразой "ЗАКРОЙТЕ ГЛАЗА". Попросите
          пациента прочитать и выполнить написанное.
        </p>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">10. Язык - Написание (Макс: 1 балл)</h2>
        <p class="instruction">
          Попросите пациента написать полное предложение (должно иметь
          подлежащее и сказуемое/дополнение и иметь смысл). (Игнорируйте
          орфографические ошибки).
        </p>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          11. Конструктивная способность - Копирование (Макс: 1 балл)
        </h2>
        <p class="instruction">
          Попросите пациента скопировать рисунок соединенных пентагонов. (1
          балл, если все 10 углов присутствуют и 2 пентагона пересекаются,
          образуя четырехугольник).
        </p>
        <div class="pentagon-container">
          <img src="pentagono.webp" alt="Соединенные пентагоны" />
        </div>
        <div class="score-box">
          <strong>Баллы:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <!-- Оценка баллов -->
      <div class="scoring-section">
        <h3>Оценка баллов (Предлагаемые пороговые значения)</h3>
        <p>
          Пороговые значения МКТ сильно зависят от образования. Ниже приведены
          значения, часто используемые в России:
        </p>
        <table>
          <thead>
            <tr>
              <th>Образование</th>
              <th>Пороговое значение (Предложение)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Неграмотные / Без образования</td>
              <td>18 - 20 баллов</td>
            </tr>
            <tr>
              <td>1-4 года (Низкое образование)</td>
              <td>25 баллов</td>
            </tr>
            <tr>
              <td>5-8 лет (Среднее образование)</td>
              <td>26,5 баллов</td>
            </tr>
            <tr>
              <td>9-11 лет (Среднее образование)</td>
              <td>28 баллов</td>
            </tr>
            <tr>
              <td>12+ лет (Высшее образование)</td>
              <td>29 баллов</td>
            </tr>
          </tbody>
        </table>
        <p style="font-size: 13px; margin-top: 10px">
          <strong>Примечание:</strong> Ошибки в воспроизведении (Память) и
          временной ориентации должны быть оценены, даже если общая оценка
          превышает пороговое значение.
        </p>
      </div>

      <!-- Блок комментариев -->
      <div class="comments-box">
        <h3>Результат и комментарии оценщика</h3>
        <textarea
          placeholder="Введите общий результат, интерпретацию на основе образования и дополнительные комментарии..."
        ></textarea>
      </div>

      <!-- Подвал с ссылкой -->
      <div class="footer">
        <p><strong>Библиографическая ссылка:</strong></p>
        <p>
          BRUCKI, S. M. D. et al. Suggestions for the use of the Mini-Mental
          State Examination in Brazil.
          <strong>Arquivos de Neuro-Psiquiatria</strong>, v. 61, n. 3B, p.
          777-781, 2003. Available at: https://pubmed.ncbi.nlm.nih.gov/14595486/
        </p>
      </div>
    </div>

    <!-- Плавающая кнопка для скачивания PDF -->
    <button
      id="btnBaixarPDF"
      class="pdf-download-button"
      title="Скачать этот отчет как PDF"
    >
      <div class="pdf-icon"><i class="fas fa-file-pdf"></i></div>
      <div class="pdf-text">Скачать PDF</div>
    </button>
    <script>
      (function () {
        const HTML2PDF_CDN =
          "https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js";

        function ensureHtml2pdf() {
          return new Promise((resolve, reject) => {
            if (window.html2pdf) return resolve(window.html2pdf);
            const s = document.createElement("script");
            s.src = HTML2PDF_CDN;
            s.onload = () => resolve(window.html2pdf);
            s.onerror = () => reject(new Error("Ошибка загрузки html2pdf"));
            document.head.appendChild(s);
          });
        }

        function montarConteudoMEEM() {
          const wrapperOriginal = document.getElementById("relatorio-meem");
          if (!wrapperOriginal) {
            alert("Элемент #relatorio-meem не найден.");
            return null;
          }

          const clone = wrapperOriginal.cloneNode(true);
          clone
            .querySelectorAll(".pdf-download-button, #btnBaixarPDF")
            .forEach((el) => el.remove());

          // --- ПРИМЕНЕННАЯ КОРРЕКЦИЯ ---
          // Определение фиксированной ширины в 'мм' для соответствия бумаге A4 (210мм)
          // за вычетом полей (например: 15мм с каждой стороны).
          // Ширина контента = 210мм - 15мм - 15мм = 180мм.

          clone.style.width = "180мм"; // Фиксированная ширина
          clone.style.maxWidth = "180мм"; // Гарантия максимальной ширины
          clone.style.margin = "0 auto";
          clone.style.background = "#fff";
          clone.style.padding = "1см"; // (10мм) Padding сохранен, но box-sizing заботится о нем.
          clone.style.boxSizing = "border-box"; // Существенно для того, чтобы padding не превысил общую ширину
          clone.style.fontFamily = "Inter, Arial, sans-serif";
          // --- КОНЕЦ КОРРЕКЦИИ ---

          const cabecalho = document.createElement("div");
          cabecalho.style.textAlign = "center";
          cabecalho.style.marginBottom = "10px";
          cabecalho.innerHTML = `
      <h1 style="font-size:20px; margin:0; color:#1A3E74;">Мини-когнитивный тест - МКТ</h1>
      <div style="font-size:12px; color:#666;">Отчет, сгенерированный автоматически</div>
      <div style="font-size:11px; color:#999;">${new Date().toLocaleString()}</div>
      <hr style="margin-top:8px; border:none; border-top:1px solid #ccc;">
    `;
          clone.insertBefore(cabecalho, clone.firstChild);

          const style = document.createElement("style");
          style.textContent = `
      .criterion-card, .patient-info {
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        margin-bottom: 12px;
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 8px;
        background: #fff;
      }
      img {
        max-width: 100% !important; /* Теперь это будет 100% от 180мм */
        height: auto !important;
        display: block;
        margin: 8px auto;
        page-break-inside: avoid !important;
      }
      h2, h3 {
        color: #1A3E74 !important;
        page-break-after: avoid !important;
      }
    `;
          clone.prepend(style);

          return clone;
        }

        async function gerarPDF() {
          const content = montarConteudoMEEM();
          if (!content) return;

          await ensureHtml2pdf();

          // --- ПРИМЕНЕННАЯ КОРРЕКЦИЯ ---
          const opt = {
            // Определяем поля в мм. (15мм с каждой стороны)
            margin: 15,
            filename: `Мини-когнитивный тест - МКТ_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, "-")}.pdf`,
            image: { type: "jpeg", quality: 0.98 },
            html2canvas: {
              scale: 2,
              useCORS: true,
              // Удаляем windowWidth и windowHeight, чтобы позволить библиотеке
              // использовать фиксированную ширину 'content'.
            },
            // Меняем единицу на 'мм' и сохраняем 'a4'
            jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
            pagebreak: { mode: ["css", "legacy"] },
          };
          // --- КОНЕЦ КОРРЕКЦИИ ---

          const imgs = content.querySelectorAll("img");
          await Promise.all(
            Array.from(imgs).map(
              (img) =>
                new Promise((res) => {
                  if (img.complete) res();
                  else img.onload = img.onerror = res;
                }),
            ),
          );

          html2pdf().set(opt).from(content).save();
        }

        document.addEventListener("DOMContentLoaded", () => {
          const btn = document.getElementById("btnBaixarPDF");
          if (!btn) return;
          btn.addEventListener("click", gerarPDF);
        });
      })();
    </script>
  </body>
</html>
