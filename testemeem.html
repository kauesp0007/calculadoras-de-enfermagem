<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Exame do Estado Mental - MEEM</title>
    <!-- Adicionada biblioteca de ícones (Font Awesome) para o ícone do botão PDF -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* Estilos Globais */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f9fafb;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            /* Garante espaço para o botão flutuante */
            padding-bottom: 120px; 
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }

        /* Cabeçalho */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #1A3E74; /* Cor do seu site */
            padding-bottom: 15px;
            margin-bottom: 20px;
            page-break-inside: avoid; /* Evitar quebra no cabeçalho */
        }

        .header h1 {
            font-size: 28px;
            font-weight: 900;
            color: #1A3E74;
            margin: 0;
        }

        .header .logo {
            max-width: 100px;
            height: auto;
            border-radius: 8px;
        }

        /* Informações do Paciente */
        .patient-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background-color: #fdfdfd;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            page-break-inside: avoid; /* Evitar quebra aqui */
        }

        .patient-info div {
            font-size: 14px;
        }

        .patient-info label {
            font-weight: 600;
            color: #555;
            display: block;
            margin-bottom: 2px;
        }

        .patient-info span {
            display: block;
            min-height: 20px;
            border-bottom: 1px dotted #ccc;
        }
        
        /* Ajuste para a data ficar na linha inteira se for ímpar */
        .patient-info div:last-child:nth-child(odd) {
            grid-column: 1 / -1;
        }


        /* Estilo dos Critérios (Baseado no seu meem.html) */
        .criterion-card {
            background-color: #fff;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            page-break-inside: avoid; /* Tenta evitar quebrar cartões */
        }

        .criterion-title {
            font-size: 18px;
            font-weight: 700;
            color: #1A3E74;
            margin-bottom: 12px;
            text-align: left; /* Padrão solicitado */
        }

        .criterion-card p,
        .criterion-card ul {
            margin: 0 0 10px 0;
            padding-left: 0;
            font-size: 15px;
        }

        .criterion-card li {
            list-style-type: none;
            position: relative;
            padding-left: 20px;
            margin-bottom: 5px;
        }
        
        .criterion-card li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: #1FA4E5; /* Cor do seu site */
            font-weight: bold;
        }
        
        .criterion-card .instruction {
            font-style: italic;
            color: #666;
            font-size: 14px;
            border-left: 3px solid #1FA4E5;
            padding-left: 10px;
            margin-top: 10px;
        }

        .score-box {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            border-top: 1px solid #eee;
            padding-top: 15px;
            margin-top: 15px;
        }

        .score-box strong {
            font-size: 14px;
            color: #333;
            margin-right: 10px;
        }

        .score-box .score-input {
            width: 70px;
            padding: 5px 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
            text-align: center;
        }

        /* Desenho (Pentágonos) */
        .pentagon-container {
            text-align: center;
            margin: 15px 0;
        }
        
        .pentagon-container img {
            max-width: 250px; /* Ajuste o tamanho se necessário */
            height: auto;
        }

        /* Avaliação do Escore */
        .scoring-section {
            padding: 20px;
            background-color: #fdfdfd;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-top: 25px;
            page-break-inside: avoid; /* Tenta evitar quebrar esta seção */
        }

        .scoring-section h3 {
            margin-top: 0;
            color: #1A3E74;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        
        .scoring-section table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .scoring-section th, .scoring-section td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .scoring-section th {
            background-color: #f4f4f4;
            font-weight: 600;
        }

        /* Caixa de Comentários */
        .comments-box {
            margin-top: 25px;
            page-break-inside: avoid; /* Tenta evitar quebrar esta caixa */
        }
        
        .comments-box h3 {
            font-size: 18px;
            font-weight: 700;
            color: #1A3E74;
            margin-bottom: 10px;
        }

        .comments-box textarea {
            width: 100%;
            height: 150px;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.8;
            /* Truque para linhas */
            background-image: linear-gradient(#eee .1em, transparent .1em);
            background-size: 100% 1.8em;
            background-attachment: local;
            box-sizing: border-box; /* Garante que o padding não estrague o layout */
        }

        /* Rodapé */
        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
            font-size: 12px;
            color: #777;
            text-align: center;
            page-break-inside: avoid; /* Tenta manter o rodapé junto */
        }

        .footer p {
            margin: 0;
        }

        /* --- Botão Flutuante de PDF --- */
        .pdf-download-button {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background-color: #1A3E74; /* Cor primária do site */
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 1000;
            width: 160px; /* Largura do cartão */
            text-align: center;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        .pdf-download-button:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
            transform: translateY(-4px); /* Efeito de "mexida" */
        }

        .pdf-download-button .pdf-icon {
            font-size: 2.5rem; /* Ícone grande */
            margin-bottom: 0.5rem;
        }

        .pdf-download-button .pdf-text {
            font-size: 1rem;
            font-weight: 600;
            line-height: 1.3;
        }
        
        /* --- Fim do Botão Flutuante --- */


        /* Impressão */
        @media print {
            body {
                background-color: #fff;
                font-size: 12pt;
                padding-bottom: 0; /* Remove padding na impressão */
            }
            .container {
                box-shadow: none;
                border: none;
                padding: 0;
                margin: 0;
                max-width: 100%;
            }
            .criterion-card {
                box-shadow: none;
                border: 1px solid #ccc;
            }
            .comments-box textarea {
                border: 1px solid #999;
                background-image: linear-gradient(#ddd .1em, transparent .1em);
            }
            .score-input {
                border: 1px solid #999;
            }
            .patient-info {
                background-color: #fff;
            }
            /* Esconde o botão de PDF durante a impressão */
            .pdf-download-button {
                display: none;
            }
        }
    </style>
    <style>
/* Remove position fixed/absolute do relatório apenas para o PDF */
.pdf-temp-root * {
  position: static !important;
  top: auto !important;
  left: auto !important;
  transform: none !important;
}

/* Impede que tabelas, divs ou imagens sejam cortadas */
#relatorio-meem, 
#relatorio-meem * {
  page-break-inside: avoid;
  break-inside: avoid;
}

/* Oculta elementos que não devem aparecer no PDF */
.no-print { display: none !important; }
</style>

</head>
<body>
    
    <!-- Script para gerar PDF -->
    <!-- Colocado no início para garantir que a biblioteca esteja disponível -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>


    <!-- O 'id="relatorio-meem"' é o alvo que o PDF vai capturar -->
    <div class="container" id="relatorio-meem">
        
        <div class="header">
            <h1>Mini Exame do Estado Mental - MEEM</h1>
            <!-- Logotipo INCORPORADO como Base64 para garantir que saia no PDF -->
            <img src="iconlogopages.webp" alt="Logotipo Calculadoras de Enfermagem" class="logo">
        </div>

        <div class="patient-info">
            <div><label>Nome do Paciente:</label><span></span></div>
            <div><label>Data de Nascimento:</label><span></span></div>
            <div><label>Idade:</label><span></span></div>
            <div><label>Nome da Mãe:</label><span></span></div>
            <div><label>Escolaridade:</label><span></span></div>
            <div><label>Sexo:</label><span></span></div>
            <div><label>Comorbidades:</label><span></span></div>
            <div><label>Referência Profissional:</label><span></span></div>
            <div><label>Data:</label><span></span></div>
        </div>

        <!-- Início da Escala MEEM -->

        <div class="criterion-card">
            <h2 class="criterion-title">1. Orientação Temporal (Máx: 5 pontos)</h2>
            <p class="instruction">Pergunte: "Em que (ano / mês / dia do mês / dia da semana) estamos? Que horas são (aproximadamente)?"</p>
            <ul>
                <li>Ano</li>
                <li>Mês</li>
                <li>Dia do mês</li>
                <li>Dia da semana</li>
                <li>Hora aproximada</li>
            </ul>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="5" class="score-input">
            </div>
        </div>

        <div class="criterion-card">
            <h2 class="criterion-title">2. Orientação Espacial (Máx: 5 pontos)</h2>
            <p class="instruction">Pergunte: "Onde nós estamos? (Que local é este / rua / bairro / cidade / estado?)"</p>
            <ul>
                <li>Local (ex: casa, consultório)</li>
                <li>Rua</li>
                <li>Bairro</li>
                <li>Cidade</li>
                <li>Estado</li>
            </ul>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="5" class="score-input">
            </div>
        </div>

        <div class="criterion-card">
            <h2 class="criterion-title">3. Registro (Máx: 3 pontos)</h2>
            <p class="instruction">"Vou dizer 3 palavras. Repita-as para mim: VASO, CARRO, TIJOLO". (1 ponto por repetição correta na primeira tentativa).</p>
            <ul>
                <li>Palavra 1 (Vaso)</li>
                <li>Palavra 2 (Carro)</li>
                <li>Palavra 3 (Tijolo)</li>
            </ul>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="3" class="score-input">
            </div>
        </div>

        <div class="criterion-card">
            <h2 class="criterion-title">4. Atenção e Cálculo (Máx: 5 pontos)</h2>
            <p class="instruction">Escolha UMA das opções:
                <br>A) "Subtraia 7 de 100, e continue subtraindo 7 do resultado, 5 vezes." (93, 86, 79, 72, 65)
                <br>B) "Soletre a palavra MUNDO de trás para frente." (O-D-N-U-M)
            </p>
            <ul>
                <li>Cálculo 1 (ou Letra 1)</li>
                <li>Cálculo 2 (ou Letra 2)</li>
                <li>Cálculo 3 (ou Letra 3)</li>
                <li>Cálculo 4 (ou Letra 4)</li>
                <li>Cálculo 5 (ou Letra 5)</li>
            </ul>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="5" class="score-input">
            </div>
        </div>

        <div class="criterion-card">
            <h2 class="criterion-title">5. Memória / Evocação (Máx: 3 pontos)</h2>
            <p class="instruction">"Quais foram as 3 palavras que pedi para você repetir agora há pouco?" (Vaso, Carro, Tijolo).</p>
            <ul>
                <li>Palavra 1 (Vaso)</li>
                <li>Palavra 2 (Carro)</li>
                <li>Palavra 3 (Tijolo)</li>
            </ul>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="3" class="score-input">
            </div>
        </div>

        <div class="criterion-card">
            <h2 class="criterion-title">6. Linguagem - Nomeação (Máx: 2 pontos)</h2>
            <p class="instruction">Mostre 2 objetos (ex: um relógio e uma caneta) e pergunte o nome de cada um.</p>
            <ul>
                <li>Objeto 1 (Relógio)</li>
                <li>Objeto 2 (Caneta)</li>
            </ul>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="2" class="score-input">
            </div>
        </div>

        <div class="criterion-card">
            <h2 class="criterion-title">7. Linguagem - Repetição (Máx: 1 ponto)</h2>
            <p class="instruction">Peça ao paciente para repetir a frase: "NEM AQUI, NEM ALI, NEM LÁ". (Apenas uma tentativa).</p>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="1" class="score-input">
            </div>
        </div>
        
        <div class="criterion-card">
            <h2 class="criterion-title">8. Linguagem - Comando (Máx: 3 pontos)</h2>
            <p class="instruction">"Siga este comando de 3 estágios:
                <br>1. Pegue este papel com a mão direita.
                <br>2. Dobre-o ao meio.
                <br>3. Coloque-o sobre a mesa."
            </p>
            <ul>
                <li>Estágio 1 (Mão direita)</li>
                <li>Estágio 2 (Dobrar ao meio)</li>
                <li>Estágio 3 (Colocar na mesa)</li>
            </ul>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="3" class="score-input">
            </div>
        </div>

        <div class="criterion-card">
            <h2 class="criterion-title">9. Linguagem - Leitura (Máx: 1 ponto)</h2>
            <p class="instruction">Entregue um papel com a frase "FECHE OS OLHOS" escrita. Peça para o paciente ler e fazer o que está escrito.</p>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="1" class="score-input">
            </div>
        </div>

        <div class="criterion-card">
            <h2 class="criterion-title">10. Linguagem - Escrita (Máx: 1 ponto)</h2>
            <p class="instruction">Peça para o paciente escrever uma frase completa (deve ter sujeito e verbo/predicado e fazer sentido). (Ignore erros de ortografia).</p>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="1" class="score-input">
            </div>
        </div>

        <div class="criterion-card">
            <h2 class="criterion-title">11. Habilidade Construtiva - Cópia (Máx: 1 ponto)</h2>
            <p class="instruction">Peça para o paciente copiar o desenho dos pentágonos interligados. (1 ponto se todos os 10 ângulos estiverem presentes e os 2 pentágonos se interceptarem formando um quadrilátero).</p>
            <div class="pentagon-container">
                <!-- Pentágono INCORPORADO como Base64 para garantir que saia no PDF -->
                <img src="pentagono.webp" alt="Pentágonos Interligados">
            </div>
            <div class="score-box">
                <strong>Pontos:</strong>
                <input type="number" min="0" max="1" class="score-input">
            </div>
        </div>

        <!-- Avaliação do Escore -->
        <div class="scoring-section">
            <h3>Avaliação do Escore (Pontos de Corte Sugeridos)</h3>
            <p>Os pontos de corte do MEEM são altamente influenciados pela escolaridade. Os valores abaixo são frequentemente usados como referência no Brasil:</p>
            <table>
                <thead>
                    <tr>
                        <th>Escolaridade</th>
                        <th>Ponto de Corte (Sugestão)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Analfabetos / Sem escolaridade</td>
                        <td>18 - 20 pontos</td>
                    </tr>
                    <tr>
                        <td>1 a 4 anos (Baixa escolaridade)</td>
                        <td>25 pontos</td>
                    </tr>
                    <tr>
                        <td>5 a 8 anos (Média escolaridade)</td>
                        <td>26,5 pontos</td>
                    </tr>
                    <tr>
                        <td>9 a 11 anos (Média escolaridade)</td>
                        <td>28 pontos</td>
                    </tr>
                    <tr>
                        <td>12+ anos (Alta escolaridade)</td>
                        <td>29 pontos</td>
                    </tr>
                </tbody>
            </table>
            <p style="font-size: 13px; margin-top: 10px;"><strong>Nota:</strong> Erros na evocação (Memória) e orientação temporal devem ser valorizados, mesmo que a pontuação final esteja acima do ponto de corte.</p>
        </div>

        <!-- Caixa de Comentários -->
        <div class="comments-box">
            <h3>Resultado e Comentários do Avaliador</h3>
            <textarea placeholder="Insira o resultado total, a interpretação baseada na escolaridade e comentários adicionais..."></textarea>
        </div>

        <!-- Rodapé com Referência -->
        <div class="footer">
            <p><strong>Referência Bibliográfica:</strong></p>
            <p>BRUCKI, S. M. D. et al. Sugestões para o uso do Mini-Exame do Estado Mental no Brasil. <strong>Arquivos de Neuro-Psiquiatria</strong>, v. 61, n. 3B, p. 777-781, 2003. Disponível em: https://www.scielo.br/j/anp/a/rfsrRVTZBxR4ShMF5hWg5JJ/</p>
        </div>

    </div>

    <<!-- Certifique-se de já ter incluido html2pdf.bundle.min.js no <head> ou antes deste script:
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
-->

<!-- Botão Flutuante para Baixar PDF -->
<button id="btnBaixarPDF" class="pdf-download-button" title="Baixar este relatório como PDF">
  <div class="pdf-icon"><i class="fas fa-file-pdf"></i></div>
  <div class="pdf-text">Baixar PDF</div>
</button>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const btn = document.getElementById('btnBaixarPDF');
    if (!btn) return;

    const CONFIG = {
        filename: 'Relatorio_MEEM.pdf',
        html2canvasScale: 2, // ajusta a qualidade do PDF
        waitAfterHideMs: 250
    };

    // Espera que todas as imagens dentro do elemento estejam carregadas
    async function esperarImagensCarregarem(element) {
        const imgs = Array.from(element.getElementsByTagName('img'));
        await Promise.all(imgs.map(img => {
            if (img.complete) return Promise.resolve();
            return new Promise(res => { img.onload = img.onerror = res; });
        }));
    }

    // Espera fontes carregarem
    async function esperarFontesCarregarem(timeout = 3000) {
        if (!document.fonts || !document.fonts.ready) return Promise.resolve();
        return Promise.race([document.fonts.ready, new Promise(res => setTimeout(res, timeout))]);
    }

    // CSS temporário para gerar PDF sem cortes
    function aplicarCssTemporario() {
        const style = document.createElement('style');
        style.id = 'pdf-temp-style';
        style.innerHTML = `
            .pdf-temp-root * { position: static !important; top: auto !important; left: auto !important; transform: none !important; }
            .no-print { display: none !important; }
            .pdf-remove-shadow { box-shadow: none !important; border: none !important; }
            #relatorio-meem, #relatorio-meem * { page-break-inside: avoid; break-inside: avoid; }
        `;
        document.head.appendChild(style);
        document.documentElement.classList.add('pdf-temp-root');
        return style;
    }

    function removerCssTemporario(style) {
        if (style && style.parentNode) style.parentNode.removeChild(style);
        document.documentElement.classList.remove('pdf-temp-root');
    }

    btn.addEventListener('click', async function () {
        const element = document.getElementById('relatorio-meem');
        if (!element) { alert('Elemento do relatório não encontrado'); return; }

        // Esconde o botão durante o PDF
        const toHide = [btn, ...Array.from(document.querySelectorAll('.no-print'))];
        const prevDisplays = toHide.map(el => el ? el.style.display : null);
        toHide.forEach(el => { if(el) el.style.display = 'none'; });

        // Salva estilos originais e aplica ajustes
        const originalStyles = {
            maxWidth: element.style.maxWidth || '',
            margin: element.style.margin || '',
            boxShadow: element.style.boxShadow || '',
            border: element.style.border || '',
            height: element.style.height || '',
            minHeight: element.style.minHeight || '',
            padding: element.style.padding || ''
        };
        element.style.maxWidth = '100%';
        element.style.margin = '0';
        element.style.height = 'auto';
        element.style.minHeight = '0';
        element.style.padding = '0';
        element.classList.add('pdf-remove-shadow');

        // Aplica CSS temporário
        const tmpStyle = aplicarCssTemporario();

        // Aguarda imagens e fontes carregarem
        await Promise.all([
            esperarImagensCarregarem(element),
            esperarFontesCarregarem(),
            new Promise(res => setTimeout(res, CONFIG.waitAfterHideMs))
        ]);

        // Configurações do PDF
        const opt = {
            margin: 0.2,
            filename: CONFIG.filename,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: {
                scale: CONFIG.html2canvasScale,
                useCORS: true,
                allowTaint: false,
                width: element.scrollWidth,
                height: element.scrollHeight
            },
            jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' },
            pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
        };

        // Gera o PDF
        await html2pdf().set(opt).from(element).save();

        // Restaura estilos originais
        element.style.maxWidth = originalStyles.maxWidth;
        element.style.margin = originalStyles.margin;
        element.style.boxShadow = originalStyles.boxShadow;
        element.style.border = originalStyles.border;
        element.style.height = originalStyles.height;
        element.style.minHeight = originalStyles.minHeight;
        element.style.padding = originalStyles.padding;
        element.classList.remove('pdf-remove-shadow');

        removerCssTemporario(tmpStyle);
        toHide.forEach((el, i) => { if (el) el.style.display = prevDisplays[i]; });
    });
});
</script>
</body>
</html>

