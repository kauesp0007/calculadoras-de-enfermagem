<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <link rel="dns-prefetch" href="//googleads.g.doubleclick.net">
  <link rel="dns-prefetch" href="//pagead2.googlesyndication.com">

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link rel="preload" href="/menu-global.html" as="fetch" crossorigin="">
  <link rel="preload" href="/global-body-elements.html" as="fetch" crossorigin="">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>F√≥rum de Enfermagem - Comunidade e Discuss√£o Cl√≠nica</title>

  <!-- Metatags e SEO -->
  <link rel="canonical" href="https://www.calculadorasdeenfermagem.com.br/forum-enfermagem.html">
  <link rel="alternate" hreflang="pt-br" href="https://www.calculadorasdeenfermagem.com.br/forum-enfermagem.html">
  <link rel="alternate" hreflang="x-default" href="https://www.calculadorasdeenfermagem.com.br/forum-enfermagem.html">
  <link rel="icon" href="favicon.ico" type="image/x-icon">

  <meta name="keywords" content="f√≥rum enfermagem, discuss√£o cl√≠nica, d√∫vidas enfermagem">
  <meta name="description"
    content="Participe do F√≥rum de Enfermagem. Espa√ßo colaborativo para d√∫vidas e casos cl√≠nicos.">
  <meta property="og:title" content="F√≥rum de Enfermagem - Comunidade">

  <!-- Scripts e Estilos -->
  <link href="/public/output.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    crossorigin="anonymous">
  <link rel="stylesheet" href="global-styles.css" media="print" onload="this.media='all'">
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700&amp;family=Inter:wght@400;700&amp;display=swap"
    rel="stylesheet">

  <!-- Supabase JS Library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Google Analytics & Consent Mode -->
  <script>
    /* =========================================================
       MODO ADMIN + GOOGLE TAG + CONSENT + ADSENSE (LAZY LOAD)
       (VERS√ÉO ULTRA R√ÅPIDA: Adia an√∫ncios para ganho de PageSpeed)
       ========================================================= */

    // üõ°Ô∏è MODO ADMIN ‚Äî bloqueia tudo
    if (localStorage.getItem('admin_mode') === 'true') {
      console.log('üöß Modo Admin: Analytics e AdSense N√ÉO foram carregados.');
    } else {
      var savedConsent = localStorage.getItem("cookieConsent");
      var isRefused = (savedConsent === "refused");
      var isManaged = (savedConsent === "managed");

      // Define se an√∫ncios come√ßam bloqueados (Recusado ou Gerenciado c/ Ad negado)
      var adsBlocked = isRefused;
      if (isManaged) {
          var savedAdStorage = localStorage.getItem("ad_storage");
          if (savedAdStorage === "denied") {
              adsBlocked = true;
          }
      }

      // Flags para evitar duplo carregamento
      window.__metricsLoaded = false;
      window.__adsenseLoaded = false;

      // Filas globais
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      window.gtag = window.gtag || gtag;

      /* -----------------------------------------------------
         1) FUN√á√ÉO: CARREGAR ANALYTICS (GTAG)
         ----------------------------------------------------- */
      function loadAnalytics() {
        if (window.__metricsLoaded) return;
        window.__metricsLoaded = true;

        var scriptGA = document.createElement('script');
        scriptGA.async = true;
        // ID Principal (G-VVDP5JGEX8)
        scriptGA.src = "https://www.googletagmanager.com/gtag/js?id=G-VVDP5JGEX8";
        document.head.appendChild(scriptGA);

        // Define status inicial baseado no hist√≥rico
        var analyticsState = "granted";
        var adsState = "granted";

        if (isRefused) {
            analyticsState = "denied";
            adsState = "denied";
        } else if (isManaged) {
            analyticsState = localStorage.getItem("analytics_storage") || "denied";
            adsState = localStorage.getItem("ad_storage") || "denied";
        }

        gtag("consent", "default", {
            analytics_storage: analyticsState,
            ad_storage: adsState,
            ad_user_data: adsState,
            ad_personalization: adsState,
            wait_for_update: 500
        });

        gtag("js", new Date());

        // Configs
        gtag("config", "G-VVDP5JGEX8");
        gtag("config", "AW-952633102");
      }

      /* -----------------------------------------------------
         2) FUN√á√ÉO: CARREGAR ADSENSE (LAZY LOAD)
         ----------------------------------------------------- */
      function loadAdSense() {
        // S√≥ carrega se n√£o foi carregado E n√£o est√° bloqueado
        if (window.__adsenseLoaded || adsBlocked) return;
        window.__adsenseLoaded = true;

        var scriptAd = document.createElement('script');
        scriptAd.async = true;
        scriptAd.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6472730056006847";
        scriptAd.crossOrigin = "anonymous";
        document.head.appendChild(scriptAd);

        console.log("üöÄ AdSense iniciado via Lazy Load.");
      }

      /* -----------------------------------------------------
         3) GATILHOS DE PERFORMANCE (A M√°gica do PageSpeed)
         ----------------------------------------------------- */
      // Carrega Analytics imediatamente (√© leve e respeita a config acima)
      loadAnalytics();

      // Carrega AdSense (pesado) apenas na intera√ß√£o do usu√°rio
      function onUserInteraction() {
        loadAdSense();
        // Remove ouvintes para n√£o rodar de novo
        window.removeEventListener('scroll', onUserInteraction);
        window.removeEventListener('mousemove', onUserInteraction);
        window.removeEventListener('touchstart', onUserInteraction);
      }

      // Se n√£o estiver bloqueado, prepara o carregamento
      if (!adsBlocked) {
        // 1. Espera intera√ß√£o (scroll, mouse, toque)
        window.addEventListener('scroll', onUserInteraction, {passive: true});
        window.addEventListener('mousemove', onUserInteraction, {passive: true});
        window.addEventListener('touchstart', onUserInteraction, {passive: true});

        // 2. Fallback: Se usu√°rio ficar parado 3.5s, carrega mesmo assim
        setTimeout(loadAdSense, 3500);
      }

      /* -----------------------------------------------------
         4) FUN√á√ïES DE CONSENTIMENTO (Update)
         ----------------------------------------------------- */
      function applyConsent(consent) {
        gtag("consent", "update", consent);

        // Salva localmente
        try {
          localStorage.setItem("analytics_storage", consent.analytics_storage);
          localStorage.setItem("ad_storage", consent.ad_storage);
        } catch (e) {}

        // Se deu permiss√£o de ads, libera o carregamento
        if (consent.ad_storage === "granted") {
            adsBlocked = false;
            loadAdSense(); // Carrega se ainda n√£o carregou
        } else {
            adsBlocked = true;
            // Nota: O AdSense n√£o tem fun√ß√£o de "unload", teria que recarregar a p√°gina
            // para parar de exibir totalmente se j√° carregou, mas visualmente removemos abaixo.
        }
      }

      /* -----------------------------------------------------
         5) API GLOBAL E RESTAURA√á√ÉO
         ----------------------------------------------------- */
      window.acceptAllCookies = function () {
        localStorage.setItem("cookieConsent", "accepted");
        applyConsent({
            analytics_storage: "granted",
            ad_storage: "granted",
            ad_user_data: "granted",
            ad_personalization: "granted"
        });
      };

      window.rejectAllCookies = function () {
        localStorage.setItem("cookieConsent", "refused");
        applyConsent({
            analytics_storage: "denied",
            ad_storage: "denied",
            ad_user_data: "denied",
            ad_personalization: "denied"
        });
        // Remove visualmente
        var ads = document.querySelectorAll('ins.adsbygoogle, .google-auto-placed');
        ads.forEach(function (ad) { ad.style.display = 'none'; ad.innerHTML = ''; });
      };

      window.applyGranularCookies = function (analyticsGranted, adsGranted) {
        localStorage.setItem("cookieConsent", "managed");
        var statusAnalytics = analyticsGranted ? "granted" : "denied";
        var statusAds = adsGranted ? "granted" : "denied";

        applyConsent({
          analytics_storage: statusAnalytics,
          ad_storage: statusAds,
          ad_user_data: statusAds,
          ad_personalization: statusAds
        });

        if (!adsGranted) {
          var ads = document.querySelectorAll('ins.adsbygoogle, .google-auto-placed');
          ads.forEach(function (ad) { ad.style.display = 'none'; ad.innerHTML = ''; });
        }
      };
    }
</script>

  <style id="otimizador-master-responsive">
    img,
    video {
      max-width: 100%;
      height: auto;
    }

    iframe {
      max-width: 100%;
    }

    body {
      overflow-x: hidden;
    }

    .forum-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .forum-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .input-field {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      margin-top: 0.25rem;
    }

    .input-field:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
  </style>
</head>

<body class="bg-gray-50 text-gray-800 font-inter">

  <nav
    class="sr-only focus-within:not-sr-only focus-within:absolute focus-within:p-4 focus-within:bg-white focus-within:z-50">
    <a href="/" class="block mb-2">Ir para o In√≠cio</a>
    <a href="#main-content" class="block mb-2">Conte√∫do Principal</a>
  </nav>

  <div id="global-header-container" style="min-height: 30px;"></div>

  <div id="language-dropdown-wrapper" class="flex justify-end w-full"
    style="position: relative; z-index: 100; padding-right: 2rem">
    <div class="relative inline-block text-left z-50" style="pointer-events: auto;">
      <button id="langButton" class="flex items-center space-x-2 border px-3 py-1 rounded-lg shadow bg-gray-100">
        <img loading="lazy" id="langFlag" width="20" height="16" src="bandeira-brasil.webp" alt="PT"
          class="w-5 h-4 rounded-sm" />
        <span id="langText" class="text-gray-700 font-medium">Portugu√™s</span>
        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>

      <div id="langMenu" class="hidden absolute right-0 mt-2 w-44 bg-white border rounded-lg shadow-lg">
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="pt"
          data-flag="bandeira-brasil.webp">
          <img loading="lazy" src="bandeira-brasil.webp" class="w-5 h-4 rounded-sm" alt="PT" width="20"
            height="16" /><span>Portugu√™s</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="en"
          data-flag="bandeira-eua.webp">
          <img loading="lazy" src="bandeira-eua.webp" class="w-5 h-4 rounded-sm" alt="EN" width="20"
            height="16" /><span>English</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="es"
          data-flag="bandeira-espanha.webp">
          <img loading="lazy" src="bandeira-espanha.webp" class="w-5 h-4 rounded-sm" alt="ES" width="20"
            height="16" /><span>Espa√±ol</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="de"
          data-flag="bandeira-alemanha.webp">
          <img loading="lazy" src="bandeira-alemanha.webp" class="w-5 h-4 rounded-sm" alt="DE" width="20"
            height="16" /><span>Deutsch</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="it"
          data-flag="bandeira-italia.webp">
          <img loading="lazy" src="bandeira-italia.webp" class="w-5 h-4 rounded-sm" alt="IT" width="20"
            height="16" /><span>Italiano</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="fr"
          data-flag="bandeira-franca.webp">
          <img loading="lazy" src="bandeira-franca.webp" class="w-5 h-4 rounded-sm" alt="FR" width="20"
            height="16" /><span>Fran√ßais</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="hi"
          data-flag="bandeira-india.webp">
          <img loading="lazy" src="bandeira-india.webp" class="w-5 h-4 rounded-sm" alt="HI" width="20"
            height="16" /><span>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="zh"
          data-flag="bandeira-china.webp">
          <img loading="lazy" src="bandeira-china.webp" class="w-5 h-4 rounded-sm" alt="ZH" width="20"
            height="16" /><span>‰∏≠Êñá</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="ar"
          data-flag="bandeira-arabia.webp">
          <img loading="lazy" src="bandeira-arabia.webp" class="w-5 h-4 rounded-sm" alt="AR" width="20"
            height="16" /><span>ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="ja"
          data-flag="bandeira-japao.webp">
          <img loading="lazy" src="bandeira-japao.webp" class="w-5 h-4 rounded-sm" alt="JA" width="20"
            height="16" /><span>Êó•Êú¨Ë™û</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="ru"
          data-flag="bandeira-russia.webp">
          <img loading="lazy" src="bandeira-russia.webp" class="w-5 h-4 rounded-sm" alt="RU" width="20"
            height="16" /><span>–†—É—Å—Å–∫–∏–π</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="ko"
          data-flag="bandeira-coreia.webp">
          <img loading="lazy" src="bandeira-coreia.webp" class="w-5 h-4 rounded-sm" alt="KO" width="20"
            height="16" /><span>ÌïúÍµ≠Ïñ¥</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="tr"
          data-flag="bandeira-turquia.webp">
          <img loading="lazy" src="bandeira-turquia.webp" class="w-5 h-4 rounded-sm" alt="TR" width="20"
            height="16" /><span>T√ºrk√ße</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="nl"
          data-flag="bandeira-holanda.webp">
          <img loading="lazy" src="bandeira-holanda.webp" class="w-5 h-4 rounded-sm" alt="NL" width="20"
            height="16" /><span>Nederlands</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="pl"
          data-flag="bandeira-polonia.webp">
          <img loading="lazy" src="bandeira-polonia.webp" class="w-5 h-4 rounded-sm" alt="PL" width="20"
            height="16" /><span>Polski</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="sv"
          data-flag="bandeira-suecia.webp">
          <img loading="lazy" src="bandeira-suecia.webp" class="w-5 h-4 rounded-sm" alt="SV" width="20"
            height="16" /><span>Su√©dois</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="id"
          data-flag="bandeira-indonesia.webp">
          <img loading="lazy" src="bandeira-indonesia.webp" class="w-5 h-4 rounded-sm" alt="ID" width="20"
            height="16" /><span>Indon√©sien</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="vi"
          data-flag="bandeira-vietna.webp">
          <img loading="lazy" src="bandeira-vietna.webp" class="w-5 h-4 rounded-sm" alt="VI" width="20"
            height="16" /><span>Ti·∫øng Vi·ªát</span>
        </div>
        <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="uk"
          data-flag="bandeira-ucrania.webp">
          <img loading="lazy" src="bandeira-ucrania.webp" class="w-5 h-4 rounded-sm" alt="UK" width="20"
            height="16" /><span>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</span>
        </div>
      </div>
    </div>
  </div>


  <div class="max-w-7xl mx-auto flex flex-col lg:flex-row lg:space-x-8 px-4 md:px-8">

    <main id="main-content" class="flex-grow w-full lg:w-3/4 py-4">
      <div class="main-content-wrapper">

        <nav class="breadcrumb" aria-label="breadcrumb">
          <ol>
            <li><a href="index.html">In√≠cio</a></li>
            <li>F√≥rum de Enfermagem</li>
          </ol>
        </nav>

        <div class="text-left mb-8">
          <h1 id="main-title" class="font-nunito font-extrabold text-dark-blue text-4xl lg:text-5xl leading-tight">
            F√≥rum da Comunidade de Enfermagem
          </h1>
          <div class="title-bar mt-2 mr-auto ml-0"></div>
          <h2 id="main-subtitle" class="font-inter font-semibold text-light-blue text-xl lg:text-2xl mt-4">
            Um espa√ßo seguro para d√∫vidas, casos cl√≠nicos e troca de experi√™ncias.
          </h2>
        </div>

        <!-- √ÅREA DE NOVO POST -->
        <div id="area-postagem" class="bg-white p-6 rounded-lg shadow-md mb-8 border border-gray-100">
          <h3 class="text-xl font-bold text-[#1A3E74] mb-4"><i class="fas fa-edit mr-2"></i>Criar Novo T√≥pico</h3>

          <form id="forumForm" class="space-y-4">
            <div>
              <label for="postUser" class="block text-sm font-medium text-gray-700">Seu Nome</label>
              <input type="text" id="postUser" class="input-field" placeholder="Ex: Enf. Ana Silva" required>
            </div>
            <div>
              <label for="postTitle" class="block text-sm font-medium text-gray-700">T√≠tulo</label>
              <input type="text" id="postTitle" class="input-field" placeholder="Ex: D√∫vida sobre medica√ß√£o..."
                required>
            </div>
            <div>
              <label for="postContent" class="block text-sm font-medium text-gray-700">Mensagem</label>
              <textarea id="postContent" rows="4" class="input-field" placeholder="Descreva aqui..."
                required></textarea>
            </div>
            <div class="flex items-center justify-between mt-4">
              <span id="formStatus" class="text-sm italic"></span>
              <button type="submit" id="submitBtn"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-md flex items-center">
                <i class="fas fa-paper-plane mr-2"></i> Publicar
              </button>
            </div>
          </form>
        </div>

        <!-- LISTA DE POSTS -->
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-2xl font-bold text-gray-800">Discuss√µes Recentes</h3>
          <button onclick="carregarPosts()" class="text-blue-600 text-sm hover:underline"><i
              class="fas fa-sync-alt"></i> Atualizar</button>
        </div>

        <div id="postsContainer" class="space-y-4 min-h-[200px]">
          <div class="text-center py-10 text-gray-500">
            <i class="fas fa-circle-notch fa-spin fa-2x mb-2"></i>
            <p>Carregando discuss√µes...</p>
          </div>
        </div>

      </div>
    </main>
  </div>

  <script src="global-scripts.js" defer=""></script>
  <script src="/lang-selector.js" defer=""></script>

  <div id="footer-placeholder"></div>
  <script>
    fetch("footer.html").then(r => r.text()).then(d => document.getElementById("footer-placeholder").innerHTML = d);
  </script>

  <!-- L√ìGICA DO SUPABASE COM DIAGN√ìSTICO E TIMEOUT -->
  <script>
    // --- SUAS CHAVES (VERIFICADAS) ---
    const SUPABASE_URL = 'https://asjkftjfbkuuhilnqonx.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFzamtmdGpmYmt1dWhpbG5xb254Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwODMxNjQsImV4cCI6MjA4MjY1OTE2NH0.mly76L5r2zoasonwta8aNND2mWWrkAoXirAAs99mDYo';

    let supabaseClient;

    document.addEventListener('DOMContentLoaded', async () => {
      if (!window.supabase) {
        mostrarErro("A biblioteca do Supabase n√£o foi carregada. Verifique sua conex√£o com a internet.");
        return;
      }

      if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
        mostrarErro("Configura√ß√£o incompleta. Verifique as chaves no c√≥digo.");
        return;
      }

      try {
        // Inicializa cliente
        supabaseClient = window.supabase.createClient(
          SUPABASE_URL,
          SUPABASE_ANON_KEY
        );

        console.log("Supabase inicializado.");
        carregarPosts();
      } catch (error) {
        mostrarErro("Erro cr√≠tico ao iniciar Supabase: " + error.message);
      }
    });

    async function carregarPosts() {
      const container = document.getElementById('postsContainer');
      container.innerHTML = `
                <div class="text-center py-10 text-gray-500">
                    <i class="fas fa-circle-notch fa-spin fa-2x mb-2"></i>
                    <p>Conectando ao banco de dados...</p>
                </div>`;

      try {
        // CRIA UM TIMEOUT DE 5 SEGUNDOS
        // Se o Supabase n√£o responder em 5s, lan√ßamos um erro manual
        const timeoutPromise = new Promise((_, reject) =>
          setTimeout(() => reject(new Error("Tempo limite excedido")), 5000)
        );

        const dataPromise = supabaseClient
          .from('posts')
          .select('*')
          .order('created_at', { ascending: false });

        // Corrida entre os dados e o rel√≥gio
        const { data, error } = await Promise.race([dataPromise, timeoutPromise]);

        // 2. Verifica erros do Supabase
        if (error) {
          throw error; // Joga para o bloco catch abaixo
        }

        // 3. Sucesso, mas vazio
        if (!data || data.length === 0) {
          container.innerHTML = `
                        <div class="text-center py-8 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                            <i class="far fa-comments text-4xl text-gray-300 mb-3"></i>
                            <p class="text-gray-500">Nenhum t√≥pico encontrado.</p>
                            <p class="text-sm text-blue-500">Seja o primeiro a postar acima!</p>
                        </div>
                    `;
          return;
        }

        // 4. Sucesso com dados -> Renderiza
        container.innerHTML = '';
        data.forEach(post => {
          const dataFormatada = new Date(post.created_at).toLocaleDateString('pt-BR', {
            day: '2-digit', month: '2-digit', year: '2-digit', hour: '2-digit', minute: '2-digit'
          });

          const postHTML = `
                        <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-100 forum-card">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="text-lg font-bold text-dark-blue">
                                    ${escapeHtml(post.titulo)}
                                </h4>
                                <span class="text-xs text-gray-400 whitespace-nowrap ml-2">
                                    <i class="far fa-clock mr-1"></i>${dataFormatada}
                                </span>
                            </div>
                            <p class="text-gray-600 text-sm mb-3 leading-relaxed">
                                ${escapeHtml(post.conteudo)}
                            </p>
                            <div class="flex items-center text-sm text-gray-500 font-medium border-t border-gray-50 pt-2">
                                <div class="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs mr-2 font-bold">
                                    ${post.nome_usuario ? post.nome_usuario.charAt(0).toUpperCase() : '?'}
                                </div>
                                ${escapeHtml(post.nome_usuario)}
                            </div>
                        </div>
                    `;
          container.innerHTML += postHTML;
        });

      } catch (error) {
        console.error('Erro Capturado:', error);

        let mensagemAmigavel = "Erro desconhecido.";

        if (error.message === "Tempo limite excedido") {
          mensagemAmigavel = `
                        <strong>O servidor demorou muito para responder.</strong><br>
                        Isso pode ser problema na sua internet ou o banco de dados est√° bloqueado.<br>
                        Verifique se o <strong>RLS est√° ativado</strong> e se existem policies permitindo <strong>SELECT</strong> para <code>anon</code>.
                    `;
        } else if (error.code === 'PGRST301' || error.message.includes('permission denied')) {
          mensagemAmigavel = `
                        <strong>Acesso Negado (RLS Ativado):</strong><br>
                        O Supabase bloqueou a leitura por seguran√ßa.<br>
                        <br>
                        <strong>Solu√ß√£o:</strong> No Supabase: Authentication/Policies (ou Table Editor ‚Üí posts ‚Üí Policies) e confirme as policies:<br>‚úÖ <code>SELECT</code> para <code>anon</code> com <code>USING (true)</code><br>‚úÖ <code>INSERT</code> para <code>anon</code> com <code>WITH CHECK (true)</code>
                    `;
        } else if (error.code === '42P01' || error.message.includes('does not exist')) {
          mensagemAmigavel = `
                        <strong>Tabela n√£o encontrada:</strong><br>
                        A tabela "posts" n√£o existe no seu projeto.<br>
                        Verifique se voc√™ criou a tabela com o nome exato "posts" (min√∫sculo).
                    `;
        } else {
          mensagemAmigavel = `Erro t√©cnico: ${error.message} (C√≥digo: ${error.code || 'N/A'})`;
        }

        mostrarErro(mensagemAmigavel);
      }
    }

    // Fun√ß√£o de envio (Create)
    const form = document.getElementById('forumForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      const status = document.getElementById('formStatus');

      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> ...';

      const user = document.getElementById('postUser').value;
      const title = document.getElementById('postTitle').value;
      const content = document.getElementById('postContent').value;

      const { error } = await supabaseClient
        .from('posts')
        .insert([{ nome_usuario: user, titulo: title, conteudo: content }]);

      if (error) {
        console.error("Erro insert:", error);
        status.innerHTML = `<span class="text-red-600">Erro: ${error.message}</span>`;
        if (error.message.includes('row-level security') || error.message.includes('permission denied')) {
          status.innerHTML = `<span class="text-red-600 font-bold">Erro de Permiss√£o (Desative o RLS)</span>`;
        }
      } else {
        status.innerHTML = `<span class="text-green-600 font-bold">Enviado!</span>`;
        form.reset();
        carregarPosts();
      }

      setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> Publicar';
        if (!error) status.innerHTML = '';
      }, 3000);
    });

    function mostrarErro(msg) {
      document.getElementById('postsContainer').innerHTML = `
                <div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-sm">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-exclamation-triangle mr-2 text-xl"></i>
                        <h3 class="font-bold text-lg">Aten√ß√£o: Erro de Conex√£o</h3>
                    </div>
                    <p>${msg}</p>
                </div>
            `;
    }

    function escapeHtml(text) {
      if (!text) return "";
      return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }
  </script>
</body>

</html>