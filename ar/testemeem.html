<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>الاختبار العقلي المصغر - MEEM</title>
    <!-- Adicionada biblioteca de ícones (Font Awesome) para o ícone do botão PDF -->
    <link
      rel="preload"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript
      ><link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    /></noscript>

    <!-- خطوط عربية -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap"
      rel="stylesheet"
    />

    <style>
      /* Estilos Globais */
      body {
        font-family:
          "Cairo",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          Helvetica,
          Arial,
          sans-serif;
        background-color: #f9fafb;
        color: #333;
        line-height: 1.6;
        margin: 0;
        padding: 0;
        /* Garante espaço para o botão flutuante */
        padding-bottom: 120px;
        text-align: right; /* Padrão RTL */
      }

      .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border: 1px solid #e5e7eb;
      }

      /* Cabeçalho */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #1a3e74; /* Cor do seu site */
        padding-bottom: 15px;
        margin-bottom: 20px;
        page-break-inside: avoid; /* Evitar quebra no cabeçalho */
      }

      .header h1 {
        font-size: 28px;
        font-weight: 900;
        color: #1a3e74;
        margin: 0;
      }

      .header .logo {
        max-width: 100px;
        height: auto;
        border-radius: 8px;
      }

      /* Informações do Paciente */
      .patient-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 25px;
        padding: 15px;
        background-color: #fdfdfd;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        page-break-inside: avoid; /* Evitar quebra aqui */
      }

      .patient-info div {
        font-size: 14px;
      }

      .patient-info label {
        font-weight: 600;
        color: #555;
        display: block;
        margin-bottom: 2px;
      }

      .patient-info span {
        display: block;
        min-height: 20px;
        border-bottom: 1px dotted #ccc;
      }

      /* Ajuste para a data ficar na linha inteira se for ímpar */
      .patient-info div:last-child:nth-child(odd) {
        grid-column: 1 / -1;
      }

      /* Estilo dos Critérios */
      .criterion-card {
        background-color: #fff;
        border: 1px solid #d1d5db;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
        page-break-inside: avoid; /* Tenta evitar quebrar cartões */
      }

      .criterion-title {
        font-size: 18px;
        font-weight: 700;
        color: #1a3e74;
        margin-bottom: 12px;
        text-align: right; /* Padrão RTL */
      }

      .criterion-card p,
      .criterion-card ul {
        margin: 0 0 10px 0;
        padding-right: 0; /* Padrão RTL */
        font-size: 15px;
      }

      .criterion-card li {
        list-style-type: none;
        position: relative;
        padding-right: 20px; /* Padrão RTL */
        padding-left: 0;
        margin-bottom: 5px;
      }

      .criterion-card li::before {
        content: "•";
        position: absolute;
        right: 0; /* Padrão RTL */
        left: auto;
        color: #1fa4e5; /* Cor do seu site */
        font-weight: bold;
      }

      .criterion-card .instruction {
        font-style: italic;
        color: #666;
        font-size: 14px;
        border-right: 3px solid #1fa4e5; /* Padrão RTL */
        border-left: none;
        padding-right: 10px; /* Padrão RTL */
        padding-left: 0;
        margin-top: 10px;
      }

      .score-box {
        display: flex;
        justify-content: flex-end; /* Mantém à direita */
        align-items: center;
        border-top: 1px solid #eee;
        padding-top: 15px;
        margin-top: 15px;
      }

      .score-box strong {
        font-size: 14px;
        color: #333;
        margin-left: 10px; /* Padrão RTL */
        margin-right: 0;
      }

      .score-box .score-input {
        width: 70px;
        padding: 5px 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
        text-align: center;
      }

      /* Desenho (Pentágonos) */
      .pentagon-container {
        text-align: center;
        margin: 15px 0;
      }

      .pentagon-container img {
        max-width: 250px;
        height: auto;
      }

      /* Avaliação do Escore */
      .scoring-section {
        padding: 20px;
        background-color: #fdfdfd;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-top: 25px;
        page-break-inside: avoid;
      }

      .scoring-section h3 {
        margin-top: 0;
        color: #1a3e74;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
      }

      .scoring-section table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      .scoring-section th,
      .scoring-section td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: right; /* Padrão RTL */
      }

      .scoring-section th {
        background-color: #f4f4f4;
        font-weight: 600;
      }

      /* Caixa de Comentários */
      .comments-box {
        margin-top: 25px;
        page-break-inside: avoid;
      }

      .comments-box h3 {
        font-size: 18px;
        font-weight: 700;
        color: #1a3e74;
        margin-bottom: 10px;
      }

      .comments-box textarea {
        width: 100%;
        height: 150px;
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 10px;
        font-family: inherit;
        font-size: 14px;
        line-height: 1.8;
        background-image: linear-gradient(#eee 0.1em, transparent 0.1em);
        background-size: 100% 1.8em;
        background-attachment: local;
        box-sizing: border-box;
        text-align: right; /* Padrão RTL */
      }

      /* Rodapé */
      .footer {
        margin-top: 30px;
        padding-top: 15px;
        border-top: 1px solid #e5e7eb;
        font-size: 12px;
        color: #777;
        text-align: center;
        page-break-inside: avoid;
      }

      .footer p {
        margin: 0;
      }

      /* --- Botão Flutuante de PDF --- */
      .pdf-download-button {
        position: fixed;
        bottom: 25px;
        left: 25px; /* Padrão RTL */
        right: auto;
        background-color: #1a3e74;
        color: #fff;
        border: none;
        border-radius: 12px;
        padding: 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        cursor: pointer;
        z-index: 1000;
        width: 160px;
        text-align: center;
        font-family:
          "Cairo",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          Helvetica,
          Arial,
          sans-serif;
      }

      .pdf-download-button:hover {
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
        transform: translateY(-4px);
      }

      .pdf-download-button .pdf-icon {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
      }

      .pdf-download-button .pdf-text {
        font-size: 1rem;
        font-weight: 600;
        line-height: 1.3;
      }

      /* --- Fim do Botão Flutuante --- */

      /* Impressão */
      @media print {
        body {
          background-color: #fff;
          font-size: 12pt;
          padding-bottom: 0;
        }
        .container {
          box-shadow: none;
          border: none;
          padding: 0;
          margin: 0;
          max-width: 100%;
        }
        .criterion-card {
          box-shadow: none;
          border: 1px solid #ccc;
        }
        .comments-box textarea {
          border: 1px solid #999;
          background-image: linear-gradient(#ddd 0.1em, transparent 0.1em);
        }
        .score-input {
          border: 1px solid #999;
        }
        .patient-info {
          background-color: #fff;
        }
        .pdf-download-button {
          display: none;
        }
      }
    </style>
    <!-- Fontes do Google (já incluídas na tradução anterior) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700&family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9472305505608641"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="container" id="relatorio-meem">
      <div class="header">
        <h1>الاختبار العقلي المصغر - MEEM</h1>
        <!-- Caminho da imagem atualizado -->
        <img src="../icondoc.webp" alt="شعار حاسبات التمريض" class="logo" />
      </div>

      <div class="patient-info">
        <div><label>اسم المريض:</label><span></span></div>
        <div><label>تاريخ الميلاد:</label><span></span></div>
        <div><label>العمر:</label><span></span></div>
        <div><label>اسم الأم:</label><span></span></div>
        <div><label>المستوى التعليمي:</label><span></span></div>
        <div><label>الجنس:</label><span></span></div>
        <div><label>الأمراض المصاحبة:</label><span></span></div>
        <div><label>مرجع مهني:</label><span></span></div>
        <div><label>التاريخ:</label><span></span></div>
      </div>

      <!-- Início da Escala MEEM -->

      <div class="criterion-card">
        <h2 class="criterion-title">
          ١. التوجيه الزماني (الحد الأقصى: ٥ نقاط)
        </h2>
        <p class="instruction">
          اسأل: "في أي (سنة / شهر / يوم في الشهر / يوم في الأسبوع) نحن؟ ما هو
          الوقت (التقريبي)؟"
        </p>
        <ul>
          <li>السنة</li>
          <li>الشهر</li>
          <li>يوم الشهر</li>
          <li>يوم الأسبوع</li>
          <li>الوقت التقريبي</li>
        </ul>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="5" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          ٢. التوجيه المكاني (الحد الأقصى: ٥ نقاط)
        </h2>
        <p class="instruction">
          اسأل: "أين نحن؟ (ما هو هذا المكان / الشارع / الحي / المدينة /
          الولاية؟)"
        </p>
        <ul>
          <li>المكان (مثل: منزل، عيادة)</li>
          <li>الشارع</li>
          <li>الحي</li>
          <li>المدينة</li>
          <li>الولاية/المحافظة</li>
        </ul>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="5" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">٣. التسجيل (الحد الأقصى: ٣ نقاط)</h2>
        <p class="instruction">
          "سأقول ٣ كلمات. كررها ورائي: مزهرية، سيارة، طوب". (نقطة واحدة لكل
          تكرار صحيح في المحاولة الأولى).
        </p>
        <ul>
          <li>الكلمة ١ (مزهرية)</li>
          <li>الكلمة ٢ (سيارة)</li>
          <li>الكلمة ٣ (طوب)</li>
        </ul>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="3" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          ٤. الانتباه والحساب (الحد الأقصى: ٥ نقاط)
        </h2>
        <p class="instruction">
          اختر واحداً من الخيارين: <br />أ) "اطرح ٧ من ١٠٠، واستمر في طرح ٧ من
          النتيجة، ٥ مرات." (٩٣، ٨٦، ٧٩، ٧٢، ٦٥) <br />ب) "تهج كلمة 'عالم'
          بالعكس." (م - ل - ا - ع)
        </p>
        <ul>
          <li>الحساب ١ (أو الحرف ١)</li>
          <li>الحساب ٢ (أو الحرف ٢)</li>
          <li>الحساب ٣ (أو الحرف ٣)</li>
          <li>الحساب ٤ (أو الحرف ٤)</li>
          <li>الحساب ٥ (أو الحرف ٥)</li>
        </ul>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="5" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          ٥. الذاكرة / الاستدعاء (الحد الأقصى: ٣ نقاط)
        </h2>
        <p class="instruction">
          "ما هي الكلمات الثلاث التي طلبت منك تكرارها قبل قليل؟" (مزهرية، سيارة،
          طوب).
        </p>
        <ul>
          <li>الكلمة ١ (مزهرية)</li>
          <li>الكلمة ٢ (سيارة)</li>
          <li>الكلمة ٣ (طوب)</li>
        </ul>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="3" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          ٦. اللغة - التسمية (الحد الأقصى: ٢ نقطتان)
        </h2>
        <p class="instruction">
          أظهر شيئين (مثل: ساعة وقلم) واسأل عن اسم كل منهما.
        </p>
        <ul>
          <li>الشيء ١ (ساعة)</li>
          <li>الشيء ٢ (قلم)</li>
        </ul>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="2" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          ٧. اللغة - التكرار (الحد الأقصى: ١ نقطة)
        </h2>
        <p class="instruction">
          اطلب من المريض تكرار الجملة: "لا هذا، ولا ذاك، ولا ذاك". (محاولة واحدة
          فقط).
        </p>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">٨. اللغة - الأمر (الحد الأقصى: ٣ نقاط)</h2>
        <p class="instruction">
          "اتبع هذا الأمر المكون من ٣ مراحل: <br />١. خذ هذه الورقة بيدك اليمنى.
          <br />٢. اطوها من المنتصف. <br />٣. ضعها على الطاولة."
        </p>
        <ul>
          <li>المرحلة ١ (اليد اليمنى)</li>
          <li>المرحلة ٢ (طيها من المنتصف)</li>
          <li>المرحلة ٣ (وضعها على الطاولة)</li>
        </ul>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="3" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          ٩. اللغة - القراءة (الحد الأقصى: ١ نقطة)
        </h2>
        <p class="instruction">
          أعط ورقة مكتوب عليها "أغمض عينيك". اطلب من المريض أن يقرأ ويفعل ما هو
          مكتوب.
        </p>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          ١٠. اللغة - الكتابة (الحد الأقصى: ١ نقطة)
        </h2>
        <p class="instruction">
          اطلب من المريض كتابة جملة كاملة (يجب أن تحتوي على فاعل وفعل/خبر وأن
          تكون ذات معنى). (تجاهل الأخطاء الإملائية).
        </p>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          ١١. المهارة البنائية - النسخ (الحد الأقصى: ١ نقطة)
        </h2>
        <p class="instruction">
          اطلب من المريض نسخ رسم الشكلين الخماسيين المتداخلين. (نقطة واحدة إذا
          كانت جميع الزوايا العشر موجودة وتقاطع الشكلان الخماسيان لتكوين شكل
          رباعي).
        </p>
        <div class="pentagon-container">
          <!-- Caminho da imagem atualizado -->
          <img src="../pentagono.webp" alt="شكلان خماسيان متداخلان" />
        </div>
        <div class="score-box">
          <strong>النقاط:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <!-- Avaliação do Escore -->
      <div class="scoring-section">
        <h3>تقييم النتيجة (النقاط الفاصلة المقترحة)</h3>
        <p>
          تتأثر النقاط الفاصلة للاختبار العقلي المصغر (MEEM) بشدة بالمستوى
          التعليمي. القيم أدناه تُستخدم غالبًا كمرجع في البرازيل:
        </p>
        <table>
          <thead>
            <tr>
              <th>المستوى التعليمي</th>
              <th>النقطة الفاصلة (مقترح)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>أميون / بدون تعليم</td>
              <td>١٨ - ٢٠ نقطة</td>
            </tr>
            <tr>
              <td>١ إلى ٤ سنوات (تعليم منخفض)</td>
              <td>٢٥ نقطة</td>
            </tr>
            <tr>
              <td>٥ إلى ٨ سنوات (تعليم متوسط)</td>
              <td>٢٦٫٥ نقطة</td>
            </tr>
            <tr>
              <td>٩ إلى ١١ سنة (تعليم متوسط)</td>
              <td>٢٨ نقطة</td>
            </tr>
            <tr>
              <td>١٢+ سنة (تعليم عالي)</td>
              <td>٢٩ نقطة</td>
            </tr>
          </tbody>
        </table>
        <p style="font-size: 13px; margin-top: 10px">
          <strong>ملاحظة:</strong> يجب تقدير الأخطاء في الاستدعاء (الذاكرة)
          والتوجيه الزماني، حتى لو كانت النتيجة النهائية أعلى من النقطة الفاصلة.
        </p>
      </div>

      <!-- Caixa de Comentários -->
      <div class="comments-box">
        <h3>نتيجة وتعليقات المُقيّم</h3>
        <textarea
          placeholder="أدخل النتيجة الإجمالية، التفسير بناءً على التعليم، وتعليقات إضافية..."
        ></textarea>
      </div>

      <!-- Rodapé com Referência -->
      <div class="footer">
        <p><strong>مرجع ببليوغرافي:</strong></p>
        <p style="text-align: left; direction: ltr">
          BRUCKI, S. M. D. et al. Sugestões para o uso do Mini-Exame do Estado
          Mental no Brasil. <strong>Arquivos de Neuro-Psiquiatria</strong>, v.
          61, n. 3B, p. 777-781, 2003. Disponível em:
          https://www.scielo.br/j/anp/a/rfsrRVTZBxR4ShMF5hWg5JJ/
        </p>
      </div>
    </div>

    <!-- Botão Flutuante para Baixar PDF -->
    <button
      id="btnBaixarPDF"
      class="pdf-download-button"
      title="تنزيل هذا التقرير كـ PDF"
    >
      <div class="pdf-icon"><i class="fas fa-file-pdf"></i></div>
      <div class="pdf-text">تنزيل PDF</div>
    </button>
    <script>
      (function () {
        const HTML2PDF_CDN =
          "https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js";

        function ensureHtml2pdf() {
          return new Promise((resolve, reject) => {
            if (window.html2pdf) return resolve(window.html2pdf);
            const s = document.createElement("script");
            s.src = HTML2PDF_CDN;
            s.onload = () => resolve(window.html2pdf);
            s.onerror = () => reject(new Error("فشل تحميل html2pdf"));
            document.head.appendChild(s);
          });
        }

        function montarConteudoMEEM() {
          const wrapperOriginal = document.getElementById("relatorio-meem");
          if (!wrapperOriginal) {
            alert("العنصر #relatorio-meem غير موجود.");
            return null;
          }

          const clone = wrapperOriginal.cloneNode(true);
          clone
            .querySelectorAll(".pdf-download-button, #btnBaixarPDF")
            .forEach((el) => el.remove());

          // --- تطبيق التصحيح ---
          clone.style.width = "180mm";
          clone.style.maxWidth = "180mm";
          clone.style.margin = "0 auto";
          clone.style.background = "#fff";
          clone.style.padding = "1cm";
          clone.style.boxSizing = "border-box";
          clone.style.fontFamily = "Cairo, Arial, sans-serif"; // استخدام الخط العربي
          // --- نهاية التصحيح ---

          const cabecalho = document.createElement("div");
          cabecalho.style.textAlign = "center";
          cabecalho.style.marginBottom = "10px";
          cabecalho.innerHTML = `
      <h1 style="font-size:20px; margin:0; color:#1A3E74;">الاختبار العقلي المصغر - MEEM</h1>
      <div style="font-size:12px; color:#666;">تقرير تم إنشاؤه تلقائيًا</div>
      <div style="font-size:11px; color:#999;">${new Date().toLocaleString("ar-EG")}</div>
      <hr style="margin-top:8px; border:none; border-top:1px solid #ccc;">
    `;
          clone.insertBefore(cabecalho, clone.firstChild);

          const style = document.createElement("style");
          style.textContent = `
      body { direction: rtl; text-align: right; }
      .criterion-card, .patient-info {
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        margin-bottom: 12px;
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 8px;
        background: #fff;
      }
      img {
        max-width: 100% !important; 
        height: auto !important;
        display: block;
        margin: 8px auto;
        page-break-inside: avoid !important;
      }
      h1, h2, h3 {
        color: #1A3E74 !important;
        page-break-after: avoid !important;
        text-align: right;
      }
      p, li, label, strong, div {
          text-align: right;
      }
      .instruction {
          border-right: 3px solid #1FA4E5 !important;
          border-left: none !important;
          padding-right: 10px !important;
          padding-left: 0 !important;
      }
      .criterion-card li::before {
          right: 0 !important;
          left: auto !important;
      }
      .criterion-card li {
          padding-right: 20px !important;
          padding-left: 0 !important;
      }
      .footer p {
          text-align: center !important; /* Rodapé centralizado */
      }
    `;
          clone.prepend(style);

          return clone;
        }

        async function gerarPDF() {
          const content = montarConteudoMEEM();
          if (!content) return;

          await ensureHtml2pdf();

          // --- تطبيق التصحيح ---
          const opt = {
            margin: 15,
            filename: `الاختبار-العقلي-المصغر-MEEM_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, "-")}.pdf`,
            image: { type: "jpeg", quality: 0.98 },
            html2canvas: {
              scale: 2,
              useCORS: true,
            },
            jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
            pagebreak: { mode: ["css", "legacy"] },
          };
          // --- نهاية التصحيح ---

          const imgs = content.querySelectorAll("img");
          await Promise.all(
            Array.from(imgs).map(
              (img) =>
                new Promise((res) => {
                  if (img.complete) res();
                  else img.onload = img.onerror = res;
                }),
            ),
          );

          html2pdf().set(opt).from(content).save();
        }

        document.addEventListener("DOMContentLoaded", () => {
          const btn = document.getElementById("btnBaixarPDF");
          if (!btn) return;
          btn.addEventListener("click", gerarPDF);
        });
      })();
    </script>
  </body>
</html>
