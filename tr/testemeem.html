<!doctype html>
<html lang="tr">
  <head>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6472730056006847" crossorigin="anonymous"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini Ruhsal Durum Muayenesi - KMMM</title>
    <!-- PDF butonu için Font Awesome ikon kütüphanesi eklendi -->
    <link
      rel="preload"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript
      ><link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    /></noscript>

    <style>
      /* Global Stiller */
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        background-color: #f9fafb;
        color: #333;
        line-height: 1.6;
        margin: 0;
        padding: 0;
        /* Yüzen buton için alan garantisi */
        padding-bottom: 120px;
      }

      .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border: 1px solid #e5e7eb;
      }

      /* Başlık */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #1a3e74; /* Sitenizin rengi */
        padding-bottom: 15px;
        margin-bottom: 20px;
        page-break-inside: avoid; /* Başlıkta kırmayı önler */
      }

      .header h1 {
        font-size: 28px;
        font-weight: 900;
        color: #1a3e74;
        margin: 0;
      }

      .header .logo {
        max-width: 100px;
        height: auto;
        border-radius: 8px;
      }

      /* Hasta Bilgileri */
      .patient-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 25px;
        padding: 15px;
        background-color: #fdfdfd;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        page-break-inside: avoid; /* Burada kırmayı önler */
      }

      .patient-info div {
        font-size: 14px;
      }

      .patient-info label {
        font-weight: 600;
        color: #555;
        display: block;
        margin-bottom: 2px;
      }

      .patient-info span {
        display: block;
        min-height: 20px;
        border-bottom: 1px dotted #ccc;
      }

      /* Tekil ise tarih için tam satır düzeltmesi */
      .patient-info div:last-child:nth-child(odd) {
        grid-column: 1 / -1;
      }

      /* Kriter Stilleri (meem.html'inize dayalı) */
      .criterion-card {
        background-color: #fff;
        border: 1px solid #d1d5db;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
        page-break-inside: avoid; /* Kartları kırmaya çalışır */
      }

      .criterion-title {
        font-size: 18px;
        font-weight: 700;
        color: #1a3e74;
        margin-bottom: 12px;
        text-align: left; /* İstenen standart */
      }

      .criterion-card p,
      .criterion-card ul {
        margin: 0 0 10px 0;
        padding-left: 0;
        font-size: 15px;
      }

      .criterion-card li {
        list-style-type: none;
        position: relative;
        padding-left: 20px;
        margin-bottom: 5px;
      }

      .criterion-card li::before {
        content: "•";
        position: absolute;
        left: 0;
        color: #1fa4e5; /* Sitenizin rengi */
        font-weight: bold;
      }

      .criterion-card .instruction {
        font-style: italic;
        color: #666;
        font-size: 14px;
        border-left: 3px solid #1fa4e5;
        padding-left: 10px;
        margin-top: 10px;
      }

      .score-box {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        border-top: 1px solid #eee;
        padding-top: 15px;
        margin-top: 15px;
      }

      .score-box strong {
        font-size: 14px;
        color: #333;
        margin-right: 10px;
      }

      .score-box .score-input {
        width: 70px;
        padding: 5px 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
        text-align: center;
      }

      /* Çizim (Beşgenler) */
      .pentagon-container {
        text-align: center;
        margin: 15px 0;
      }

      .pentagon-container img {
        max-width: 250px; /* Gerekirse boyutu ayarlayın */
        height: auto;
      }

      /* Skor Değerlendirmesi */
      .scoring-section {
        padding: 20px;
        background-color: #fdfdfd;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-top: 25px;
        page-break-inside: avoid; /* Bu bölümü kırmaya çalışır */
      }

      .scoring-section h3 {
        margin-top: 0;
        color: #1a3e74;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
      }

      .scoring-section table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      .scoring-section th,
      .scoring-section td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }

      .scoring-section th {
        background-color: #f4f4f4;
        font-weight: 600;
      }

      /* Yorumlar Kutusu */
      .comments-box {
        margin-top: 25px;
        page-break-inside: avoid; /* Bu kutu kırmaya çalışır */
      }

      .comments-box h3 {
        font-size: 18px;
        font-weight: 700;
        color: #1a3e74;
        margin-bottom: 10px;
      }

      .comments-box textarea {
        width: 100%;
        height: 150px;
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 10px;
        font-family: inherit;
        font-size: 14px;
        line-height: 1.8;
        /* Çizgiler için hile */
        background-image: linear-gradient(#eee 0.1em, transparent 0.1em);
        background-size: 100% 1.8em;
        background-attachment: local;
        box-sizing: border-box; /* Padding'in layout'u bozmasını sağlar */
      }

      /* Alt Bilgi */
      .footer {
        margin-top: 30px;
        padding-top: 15px;
        border-top: 1px solid #e5e7eb;
        font-size: 12px;
        color: #777;
        text-align: center;
        page-break-inside: avoid; /* Alt bilgiyi birlikte tutmaya çalışır */
      }

      .footer p {
        margin: 0;
      }

      /* --- Yüzen PDF Butonu --- */
      .pdf-download-button {
        position: fixed;
        bottom: 25px;
        right: 25px;
        background-color: #1a3e74; /* Sitenizin birincil rengi */
        color: #fff;
        border: none;
        border-radius: 12px;
        padding: 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        cursor: pointer;
        z-index: 1000;
        width: 160px; /* Kartın genişliği */
        text-align: center;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
      }

      .pdf-download-button:hover {
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
        transform: translateY(-4px); /* "Sallama" efekti */
      }

      .pdf-download-button .pdf-icon {
        font-size: 2.5rem; /* Büyük ikon */
        margin-bottom: 0.5rem;
      }

      .pdf-download-button .pdf-text {
        font-size: 1rem;
        font-weight: 600;
        line-height: 1.3;
      }

      /* --- Yüzen Buton Sonu --- */

      /* Baskı */
      @media print {
        body {
          background-color: #fff;
          font-size: 12pt;
          padding-bottom: 0; /* Baskıda padding'i kaldırır */
        }
        .container {
          box-shadow: none;
          border: none;
          padding: 0;
          margin: 0;
          max-width: 100%;
        }
        .criterion-card {
          box-shadow: none;
          border: 1px solid #ccc;
        }
        .comments-box textarea {
          border: 1px solid #999;
          background-image: linear-gradient(#ddd 0.1em, transparent 0.1em);
        }
        .score-input {
          border: 1px solid #999;
        }
        .patient-info {
          background-color: #fff;
        }
        /* PDF butonunu baskı sırasında gizler */
        .pdf-download-button {
          display: none;
        }
      }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700&family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9472305505608641"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="container" id="relatorio-meem">
      <div class="header">
        <h1>Mini Ruhsal Durum Muayenesi - KMMM</h1>

        <img
          src="icondoc.webp"
          alt="Hemşirelik Hesaplayıcıları Logosu"
          class="logo"
        />
      </div>

      <div class="patient-info">
        <div><label>Hasta Adı:</label><span></span></div>
        <div><label>Doğum Tarihi:</label><span></span></div>
        <div><label>Yaş:</label><span></span></div>
        <div><label>Anne Adı:</label><span></span></div>
        <div><label>Eğitim Seviyesi:</label><span></span></div>
        <div><label>Cinsiyet:</label><span></span></div>
        <div><label>Eşlik Eden Hastalıklar:</label><span></span></div>
        <div><label>Profesyonel Yönlendirme:</label><span></span></div>
        <div><label>Tarih:</label><span></span></div>
      </div>

      <!-- KMMM Ölçeği Başlangıcı -->

      <div class="criterion-card">
        <h2 class="criterion-title">1. Zaman Yönlendirmesi (Maks: 5 puan)</h2>
        <p class="instruction">
          Sorun: "Hangi (yıl / ay / ayın günü / haftanın günü) olduğumuzu? Kaç
          saat (yaklaşık)?"
        </p>
        <ul>
          <li>Yıl</li>
          <li>Ay</li>
          <li>Ayın günü</li>
          <li>Haftanın günü</li>
          <li>Yaklaşık saat</li>
        </ul>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="5" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">2. Mekân Yönlendirmesi (Maks: 5 puan)</h2>
        <p class="instruction">
          Sorun: "Neredeyiz? (Bu hangi yer / sokak / mahalle / şehir / il?)"
        </p>
        <ul>
          <li>Yer (örn: ev, muayenehane)</li>
          <li>Sokak</li>
          <li>Mahalle</li>
          <li>Şehir</li>
          <li>İl</li>
        </ul>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="5" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">3. Kayıt (Maks: 3 puan)</h2>
        <p class="instruction">
          "3 kelime söyleyeceğim. Onları tekrarlayın: VAZO, ARABA, TUĞLA". (İlk
          denemede doğru tekrar için 1 puan).
        </p>
        <ul>
          <li>1. Kelime (Vazo)</li>
          <li>2. Kelime (Araba)</li>
          <li>3. Kelime (Tuğla)</li>
        </ul>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="3" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">4. Dikkat ve Hesaplama (Maks: 5 puan)</h2>
        <p class="instruction">
          Seçeneklerden BİRİNİ seçin: <br />A) "100'den 7 çıkarın ve sonuçtan 7
          çıkarmaya devam edin, 5 kez." (93, 86, 79, 72, 65) <br />B) "DÜNYA
          kelimesini tersten heceleyin." (O-D-N-U-M)
        </p>
        <ul>
          <li>Hesaplama 1 (veya Harf 1)</li>
          <li>Hesaplama 2 (veya Harf 2)</li>
          <li>Hesaplama 3 (veya Harf 3)</li>
          <li>Hesaplama 4 (veya Harf 4)</li>
          <li>Hesaplama 5 (veya Harf 5)</li>
        </ul>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="5" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">5. Bellek / Anımsama (Maks: 3 puan)</h2>
        <p class="instruction">
          "Az önce tekrarlamanızı istediğim 3 kelime nelerdi?" (Vazo, Araba,
          Tuğla).
        </p>
        <ul>
          <li>1. Kelime (Vazo)</li>
          <li>2. Kelime (Araba)</li>
          <li>3. Kelime (Tuğla)</li>
        </ul>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="3" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">6. Dil - Adlandırma (Maks: 2 puan)</h2>
        <p class="instruction">
          2 nesne gösterin (örn: bir saat ve bir kalem) ve her birinin adını
          sorun.
        </p>
        <ul>
          <li>Nesne 1 (Saat)</li>
          <li>Nesne 2 (Kalem)</li>
        </ul>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="2" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">7. Dil - Tekrar (Maks: 1 puan)</h2>
        <p class="instruction">
          Hastadan şu cümleyi tekrarlamasını isteyin: "NE BURALARDA, NE ORADA,
          NE BURADA". (Sadece bir deneme).
        </p>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">8. Dil - Komut (Maks: 3 puan)</h2>
        <p class="instruction">
          "Bu üç aşamalı komutu izleyin: <br />1. Bu kâğıdı sağ elinizle alın.
          <br />2. Ortasından katlayın. <br />3. Masaya koyun."
        </p>
        <ul>
          <li>Aşama 1 (Sağ el)</li>
          <li>Aşama 2 (Ortadan katlama)</li>
          <li>Aşama 3 (Masaya koyma)</li>
        </ul>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="3" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">9. Dil - Okuma (Maks: 1 puan)</h2>
        <p class="instruction">
          "GÖZLERİNİ KAPAT" yazısı olan bir kâğıt verin. Hastadan okumasını ve
          yazılanı yapmasını isteyin.
        </p>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">10. Dil - Yazma (Maks: 1 puan)</h2>
        <p class="instruction">
          Hastadan tam bir cümle yazmasını isteyin (özne ve fiil/yüklem içermeli
          ve anlamlı olmalı). (Yazım hatalarını göz ardı edin).
        </p>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <div class="criterion-card">
        <h2 class="criterion-title">
          11. Yapısal Beceri - Kopyalama (Maks: 1 puan)
        </h2>
        <p class="instruction">
          Hastadan bağlı beşgenlerin çizimini kopyalamasını isteyin. (Tüm 10 açı
          mevcutsa ve 2 beşgen dörtgen oluşturacak şekilde kesişiyorsa 1 puan).
        </p>
        <div class="pentagon-container">
          <img src="pentagono.webp" alt="Bağlı Beşgenler" />
        </div>
        <div class="score-box">
          <strong>Puanlar:</strong>
          <input type="number" min="0" max="1" class="score-input" />
        </div>
      </div>

      <!-- Skor Değerlendirmesi -->
      <div class="scoring-section">
        <h3>Skor Değerlendirmesi (Önerilen Kesim Noktaları)</h3>
        <p>
          KMMM'nin kesim noktaları eğitim seviyesinden oldukça etkilenir.
          Aşağıdaki değerler Brezilya'da referans olarak sıkça kullanılır:
        </p>
        <table>
          <thead>
            <tr>
              <th>Eğitim Seviyesi</th>
              <th>Kesim Noktası (Öneri)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Okuma yazma bilmeyen / Eğitimsiz</td>
              <td>18 - 20 puan</td>
            </tr>
            <tr>
              <td>1-4 yıl (Düşük eğitim)</td>
              <td>25 puan</td>
            </tr>
            <tr>
              <td>5-8 yıl (Orta eğitim)</td>
              <td>26,5 puan</td>
            </tr>
            <tr>
              <td>9-11 yıl (Orta eğitim)</td>
              <td>28 puan</td>
            </tr>
            <tr>
              <td>12+ yıl (Yüksek eğitim)</td>
              <td>29 puan</td>
            </tr>
          </tbody>
        </table>
        <p style="font-size: 13px; margin-top: 10px">
          <strong>Not:</strong> Anımsama (Bellek) ve zaman yönlendirmesindeki
          hatalar, final puanı kesim noktasının üzerinde olsa bile değer
          verilmelidir.
        </p>
      </div>

      <!-- Yorumlar Kutusu -->
      <div class="comments-box">
        <h3>Sonuç ve Değerlendirici Yorumları</h3>
        <textarea
          placeholder="Toplam sonucu, eğitim seviyesine dayalı yorumu ve ek yorumları ekleyin..."
        ></textarea>
      </div>

      <!-- Kaynakla Alt Bilgi -->
      <div class="footer">
        <p><strong>Kaynakça:</strong></p>
        <p>
          COELHO, F. G. M.; SANTOS-GALDURÓZ, R. F.; BUCKEN-GOBI, G. N. S.;
          SANTOS-GALDURÓZ, J.; VIEIRA, S. A.; FERREIRA, L. S. Cognitive
          performance of elderly people living in the community and in long-stay
          institutions. **Acta Paulista de Enfermagem**, v. 29, n. 2, p.
          163-170, 2016. Available at:
          https://www.scielo.br/j/ape/a/3HqY8B4N3K9j3sF4d6vX7zS/
        </p>
      </div>
    </div>

    <!-- PDF İndirmek İçin Yüzen Buton -->
    <button
      id="btnBaixarPDF"
      class="pdf-download-button"
      title="Bu raporu PDF olarak indir"
    >
      <div class="pdf-icon"><i class="fas fa-file-pdf"></i></div>
      <div class="pdf-text">PDF İndir</div>
    </button>
    <script>
      (function () {
        const HTML2PDF_CDN =
          "https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js";

        function ensureHtml2pdf() {
          return new Promise((resolve, reject) => {
            if (window.html2pdf) return resolve(window.html2pdf);
            const s = document.createElement("script");
            s.src = HTML2PDF_CDN;
            s.onload = () => resolve(window.html2pdf);
            s.onerror = () => reject(new Error("html2pdf yüklenemedi"));
            document.head.appendChild(s);
          });
        }

        function montarConteudoMEEM() {
          const wrapperOriginal = document.getElementById("relatorio-meem");
          if (!wrapperOriginal) {
            alert("#relatorio-meem öğesi bulunamadı.");
            return null;
          }

          const clone = wrapperOriginal.cloneNode(true);
          clone
            .querySelectorAll(".pdf-download-button, #btnBaixarPDF")
            .forEach((el) => el.remove());

          // --- UYGULANAN DÜZELTME ---
          // A4 kağıdı (210mm) ile eşleşmek için sabit genişlik 'mm' olarak tanımlanır
          // marjlar çıkarılır (ör: her taraftan 15mm).
          // İçerik genişliği = 210mm - 15mm - 15mm = 180mm.

          clone.style.width = "180mm"; // Sabit genişlik
          clone.style.maxWidth = "180mm"; // Maksimum genişlik garantisi
          clone.style.margin = "0 auto";
          clone.style.background = "#fff";
          clone.style.padding = "1cm"; // (10mm) Padding korunur, box-sizing onunla ilgilenir.
          clone.style.boxSizing = "border-box"; // Padding'in toplam genişliği aşmaması için gerekli
          clone.style.fontFamily = "Inter, Arial, sans-serif";
          // --- DÜZELTME SONu ---

          const cabecalho = document.createElement("div");
          cabecalho.style.textAlign = "center";
          cabecalho.style.marginBottom = "10px";
          cabecalho.innerHTML = `
      <h1 style="font-size:20px; margin:0; color:#1A3E74;">Mini Ruhsal Durum Muayenesi - KMMM</h1>
      <div style="font-size:12px; color:#666;">Otomatik oluşturulmuş rapor</div>
      <div style="font-size:11px; color:#999;">${new Date().toLocaleString()}</div>
      <hr style="margin-top:8px; border:none; border-top:1px solid #ccc;">
    `;
          clone.insertBefore(cabecalho, clone.firstChild);

          const style = document.createElement("style");
          style.textContent = `
      .criterion-card, .patient-info {
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        margin-bottom: 12px;
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 8px;
        background: #fff;
      }
      img {
        max-width: 100% !important; /* Bu artık 180mm'in %100'ü olacak */
        height: auto !important;
        display: block;
        margin: 8px auto;
        page-break-inside: avoid !important;
      }
      h2, h3 {
        color: #1A3E74 !important;
        page-break-after: avoid !important;
      }
    `;
          clone.prepend(style);

          return clone;
        }

        async function gerarPDF() {
          const content = montarConteudoMEEM();
          if (!content) return;

          await ensureHtml2pdf();

          // --- UYGULANAN DÜZELTME ---
          const opt = {
            // Kenar boşluklarını mm olarak tanımlıyoruz. (Her taraftan 15mm)
            margin: 15,
            filename: `Mini Ruhsal Durum Muayenesi - KMMM_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, "-")}.pdf`,
            image: { type: "jpeg", quality: 0.98 },
            html2canvas: {
              scale: 2,
              useCORS: true,
              // 'content'un sabit genişliğini kullanması için windowWidth ve windowHeight'ı kaldırıyoruz
              // kütüphanenin
            },
            // Birimi 'mm' olarak değiştiriyoruz ve 'a4' tutuyoruz
            jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
            pagebreak: { mode: ["css", "legacy"] },
          };
          // --- DÜZELTME SONu ---

          const imgs = content.querySelectorAll("img");
          await Promise.all(
            Array.from(imgs).map(
              (img) =>
                new Promise((res) => {
                  if (img.complete) res();
                  else img.onload = img.onerror = res;
                }),
            ),
          );

          html2pdf().set(opt).from(content).save();
        }

        document.addEventListener("DOMContentLoaded", () => {
          const btn = document.getElementById("btnBaixarPDF");
          if (!btn) return;
          btn.addEventListener("click", gerarPDF);
        });
      })();
    </script>
  </body>
</html>
