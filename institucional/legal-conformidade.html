<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="https://www.calculadorasdeenfermagem.com.br/">
    <title>Repositório de Conformidade | Calculadoras de Enfermagem</title>
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="Repositório de arquivos do site Calculadoras de Enfermagem voltados para Políticas de privacidade, termos de uso, LGPD e outras diretrizes de conformidade.">
    <link rel="canonical" href="https://www.calculadorasdeenfermagem.com.br/institucional/legal-conformidade.html">
    <link rel="icon" href="images/favicon.png" type="image/png">
    
    <!-- Scripts e Estilos Globais do Site -->
    <script src="https://cdn.tailwindcss.com" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Nunito+Sans:wght@700;800;900&display=swap" rel="stylesheet">
    
    <!-- TinyMCE Rich Text Editor -->
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

    <style>
        /* Estilos Globais e Variáveis CSS */
        :root {
            --primary-color: #1a3e74;
            --primary-light: #2a5a94;
            --white: #ffffff;
            --text-color: #2c2c2c;
            --shadow: 0 4px 20px rgba(26, 62, 116, 0.1);
            --border-radius: 12px;
            --bg-light: #f8f9fa;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-color);
        }
        
        .main-container-wrapper { padding: 2rem; background-color: var(--bg-light); }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
        .status-publicado { background-color: #D1FAE5; color: #065F46; }
        .status-elaboracao { background-color: #FEF3C7; color: #92400E; }
        .status-revisao { background-color: #DBEAFE; color: #1E40AF; }
        .status-aprovacao { background-color: #E0E7FF; color: #3730A3; }
        .status-agendado { background-color: #F3E8FF; color: #6B21A8; }

        /* Estilos do Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.6); display: flex;
            align-items: center; justify-content: center; z-index: 1000;
            opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background: white; padding: 2rem; border-radius: var(--border-radius);
            width: 90%; max-width: 700px; transform: scale(0.95);
            transition: transform 0.3s;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }
    </style>
</head>
<body class="hidden">
    <div id="global-header-container"></div>
<div id="language-dropdown-wrapper" class="flex justify-end w-full" style="position:relative; z-index:100; padding-right:2rem;">
  <div class="relative inline-block text-left z-50">
    <button id="langButton" class="flex items-center space-x-2 border px-3 py-1 rounded-lg shadow bg-gray-100">
      <img id="langFlag" src="bandeira-brasil.webp" alt="BR" class="w-5 h-4 rounded-sm">
      <span id="langText" class="text-gray-700 font-medium">Português</span>
      <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    </button>

    <div id="langMenu" class="hidden absolute right-0 mt-2 w-44 bg-white border rounded-lg shadow-lg">
      <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="pt" data-flag="bandeira-brasil.webp">
        <img src="bandeira-brasil.webp" class="w-5 h-4 rounded-sm" alt="BR"><span>Português</span>
      </div>
      <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="en" data-flag="bandeira-eua.webp">
        <img src="bandeira-eua.webp" class="w-5 h-4 rounded-sm" alt="EN"><span>English</span>
      </div>
      <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="es" data-flag="bandeira-espanha.webp">
        <img src="bandeira-espanha.webp" class="w-5 h-4 rounded-sm" alt="ES"><span>Español</span>
      </div>
      <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="de" data-flag="bandeira-alemanha.webp">
        <img src="bandeira-alemanha.webp" class="w-5 h-4 rounded-sm" alt="DE"><span>Deutsch</span>
      </div>
      <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="it" data-flag="bandeira-italia.webp">
        <img src="bandeira-italia.webp" class="w-5 h-4 rounded-sm" alt="IT"><span>Italiano</span>
      </div>
      <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="fr" data-flag="bandeira-franca.webp">
        <img src="bandeira-franca.webp" class="w-5 h-4 rounded-sm" alt="FR"><span>Français</span>
      </div>
      <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="fr" data-flag="bandeira-franca.webp">
        <img src="bandeira-india.webp" class="w-5 h-4 rounded-sm" alt="IN"><span>भारत</span>
      </div>
      <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="fr" data-flag="bandeira-franca.webp">
        <img src="bandeira-china.webp" class="w-5 h-4 rounded-sm" alt="CN"><span>中国</span>
      </div>
      <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="fr" data-flag="bandeira-franca.webp">
        <img src="bandeira-arabia.webp" class="w-5 h-4 rounded-sm" alt="AR"><span>اللغة العربية</span>
      </div>
      <div class="flex items-center px-3 py-2 hover:bg-gray-100 cursor-pointer space-x-2" data-value="fr" data-flag="bandeira-franca.webp">
        <img src="bandeira-japao.webp" class="w-5 h-4 rounded-sm" alt="JP"><span>日本語</span>
      </div>
    </div>
  </div>
</div><main class="main-container-wrapper">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-2">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Repositório de Conformidade</h1>
                    <p class="text-gray-600 mt-1">Gerencie as políticas e diretrizes do site.</p>
                </div>
                <div class="flex items-center gap-4">
                     <button id="add-new-policy-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold flex items-center gap-2">
                        <i class="fas fa-plus-circle"></i>
                        Nova Política
                    </button>
                    <div id="user-info" class="text-right"></div>
                </div>
            </div>
            
            <div id="pending-alerts" class="my-6"></div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="grid grid-cols-6 items-center gap-4 pb-4 border-b font-bold text-gray-500 text-sm">
                    <div class="col-span-2">DOCUMENTO</div>
                    <div>VERSÃO PUBLICADA</div>
                    <div>VERSÃO APROVADA</div>
                    <div>STATUS WORKFLOW</div>
                    <div class="text-right">AÇÕES</div>
                </div>
                <div id="document-list"></div>
            </div>
        </div>
    </main>
    
    <!-- Modal para Nova Versão / Nova Política -->
    <div id="version-modal" class="modal-overlay">
        <div class="modal-content" role="dialog" aria-modal="true">
            <div class="flex justify-between items-center mb-4 pb-4 border-b">
                <h2 class="text-2xl font-bold text-gray-800" id="modal-title"></h2>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl" aria-label="Fechar">&times;</button>
            </div>
            <div id="modal-form-content" class="space-y-4">
                <!-- Campos do formulário serão inseridos aqui -->
            </div>
            <div class="flex justify-end gap-4 mt-6 pt-4 border-t">
                <button id="cancel-modal-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancelar</button>
                <button id="save-modal-btn" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Salvar</button>
            </div>
        </div>
    </div>

    <div id="global-body-elements-container"></div>

    <!-- Firebase SDKs e Lógica da Aplicação -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, updateDoc, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyC1US-K0KoiE9OS4IGalxkNUwqSicTPbeA",
            authDomain: "acesso-restrito-github.firebaseapp.com",
            projectId: "acesso-restrito-github",
            storageBucket: "acesso-restrito-github.firebasestorage.app",
            messagingSenderId: "32644970643",
            appId: "1:32644970643:web:92f5f3653ddeaa8ac0b566"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let documents = [];
        let activeDocument = null;
        let isNewPolicyMode = false;
        const workflowSteps = ['Iniciação', 'Elaboração', 'Revisão', 'Aprovação', 'Publicado'];
        const users = {
            'kauesp07@hotmail.com': { name: 'Cauê Silvério Marques Zipfel', roles: ['Administrador', 'Revisor', 'Editor'] },
            'leivis.ml@gmail.com': { name: 'Leivis de Melo Lima', roles: ['Editor'] }
        };

        onAuthStateChanged(auth, (user) => {
            if (user && users[user.email]) {
                currentUser = { email: user.email, ...users[user.email] };
                document.body.classList.remove('hidden');
                initializeAppLogic();
            } else {
                window.location.href = 'institucional/acessorestrito.html';
            }
        });

        function initializeAppLogic() {
            renderUserInfo();
            setupFirestoreListener();
            setupGlobalEventListeners();
        }

        function renderUserInfo() {
            const userInfoEl = document.getElementById('user-info');
            if(userInfoEl && currentUser) {
                userInfoEl.innerHTML = `
                    <div>
                        <span class="font-bold">${currentUser.name}</span>
                        <span class="text-sm text-gray-500">(${currentUser.roles.join(', ')})</span>
                    </div>
                    <button id="sign-out-btn" class="text-sm text-blue-600 hover:underline">Sair</button>
                `;
                document.getElementById('sign-out-btn').addEventListener('click', () => signOut(auth));
            }
        }

        function renderDocuments() {
            const listEl = document.getElementById('document-list');
            if (!listEl) return;
            listEl.innerHTML = ''; // Limpa a lista para renderizar novamente
            documents.forEach(doc => {
                const docEl = document.createElement('div');
                const hasPendingWorkflow = !!doc.workflow;
                docEl.className = 'grid grid-cols-6 items-center gap-4 py-4 border-b last:border-b-0';
                 if (hasPendingWorkflow) docEl.classList.add('bg-yellow-50', 'pl-4', 'border-l-4', 'border-yellow-400');

                docEl.innerHTML = `
                    <div class="col-span-2 font-semibold text-gray-800 flex items-center gap-3">
                        ${hasPendingWorkflow ? `<i class="fas fa-hourglass-half text-yellow-500" title="Workflow: ${doc.workflow.status}"></i>` : ''}
                        <a href="${doc.url}" target="_blank" title="Abrir documento" class="hover:underline">${doc.title} <i class="fas fa-external-link-alt text-xs text-gray-400"></i></a>
                    </div>
                    <div>v${doc.publishedVersion}</div>
                    <div>v${doc.latestApprovedVersion}</div>
                    <div>${hasPendingWorkflow ? `<span class="status-badge status-${doc.workflow.status.toLowerCase()}">${doc.workflow.status}</span>` : '<span class="text-gray-400">-</span>'}</div>
                    <div class="flex justify-end gap-2" data-doc-id="${doc.id}">
                        <button data-action="history" class="px-3 py-1 text-sm bg-gray-100 rounded-md hover:bg-gray-200">Histórico</button>
                        <button data-action="new-version" class="px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200" ${hasPendingWorkflow || !currentUser.roles.includes('Editor') ? 'disabled' : ''}>Nova Versão</button>
                    </div>
                `;
                listEl.appendChild(docEl);
            });
        }

        function setupFirestoreListener() {
            const docsCollection = collection(db, 'legal_documents');
            onSnapshot(docsCollection, (snapshot) => {
                documents = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderDocuments();
            }, (error) => console.error("Erro ao buscar documentos: ", error));
        }
        
        // --- Lógica dos Modais ---
        function openModal(id) { document.getElementById(id)?.classList.add('visible'); }
        function closeModal(id) { document.getElementById(id)?.classList.remove('visible'); }

        function showNewPolicyModal() {
            isNewPolicyMode = true;
            activeDocument = null;
            document.getElementById('modal-title').textContent = 'Criar Nova Política';
            const formContent = document.getElementById('modal-form-content');
            formContent.innerHTML = `
                <div>
                    <label for="policy-title" class="block text-sm font-medium text-gray-700">Título do Documento</label>
                    <input type="text" id="policy-title" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="policy-url" class="block text-sm font-medium text-gray-700">URL do Documento</label>
                    <input type="url" id="policy-url" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="policy-summary" class="block text-sm font-medium text-gray-700">Resumo</label>
                    <textarea id="policy-summary" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Versão inicial publicada"></textarea>
                </div>
                 <div>
                    <label for="policy-content" class="block text-sm font-medium text-gray-700">Conteúdo Inicial</label>
                    <textarea id="policy-content" rows="6" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Insira o conteúdo completo da política aqui..."></textarea>
                </div>
            `;
            openModal('version-modal');
        }

        function showNewVersionModal(docId) {
            isNewPolicyMode = false;
            activeDocument = documents.find(d => d.id === docId);
            if (!activeDocument) return;

            document.getElementById('modal-title').textContent = `Nova Versão para: ${activeDocument.title}`;
            const formContent = document.getElementById('modal-form-content');
            formContent.innerHTML = `
                <div class="bg-gray-100 p-3 rounded-md">
                    <p><span class="font-semibold">Versão Anterior Aprovada:</span> v${activeDocument.latestApprovedVersion}</p>
                </div>
                <div>
                    <label for="version-summary" class="block text-sm font-medium text-gray-700">Resumo das Alterações</label>
                    <textarea id="version-summary" rows="4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Descreva o que foi alterado nesta nova versão..."></textarea>
                </div>
            `;
            openModal('version-modal');
        }
        
        async function handleSave() {
            const saveButton = document.getElementById('save-modal-btn');
            saveButton.disabled = true;
            saveButton.textContent = 'Salvando...';

            try {
                if (isNewPolicyMode) {
                    // --- LÓGICA PARA CRIAR NOVA POLÍTICA ---
                    const title = document.getElementById('policy-title').value;
                    const url = document.getElementById('policy-url').value;
                    let summary = document.getElementById('policy-summary').value;
                    const content = document.getElementById('policy-content').value;

                    if (!title || !url || !content) {
                        alert('Título, URL e Conteúdo são obrigatórios.');
                        return;
                    }
                    if (!summary) {
                        summary = "Versão inicial publicada";
                    }

                    const newPolicy = {
                        title: title,
                        content: content,
                        date: serverTimestamp(), // Data e hora do servidor
                        latestApprovedVersion: "1.0",
                        publishedVersion: "1.0",
                        summary: summary,
                        url: url,
                        workflow: null // Workflow nulo para novos arquivos
                    };
                    
                    await addDoc(collection(db, 'legal_documents'), newPolicy);
                    console.log("Nova política adicionada com sucesso!");

                } else {
                    // --- LÓGICA PARA CRIAR NOVA VERSÃO ---
                    if (!activeDocument) return;
                    
                    const summary = document.getElementById('version-summary').value;
                    if (!summary) {
                        alert('O resumo das alterações é obrigatório.');
                        return;
                    }

                    const [major, minor] = activeDocument.latestApprovedVersion.split('.').map(Number);
                    const newVersionNumber = `${major}.${minor + 1}`;

                    const newVersionData = {
                        workflow: {
                            title: activeDocument.title, // Mesmo título
                            content: activeDocument.content, // Mesmo conteúdo para edição
                            date: serverTimestamp(), // Data e hora do servidor
                            latestApprovedVersion: activeDocument.latestApprovedVersion, // Versão anterior
                            publishedVersion: newVersionNumber, // Nova versão sequencial
                            summary: summary, // Resumo do usuário
                            url: activeDocument.url, // Mesma URL
                            status: workflowSteps[1], // Inicia em "Elaboração"
                            currentStep: 1,
                            version: newVersionNumber
                        }
                    };
                    
                    const docRef = doc(db, 'legal_documents', activeDocument.id);
                    await updateDoc(docRef, newVersionData);
                    console.log(`Workflow de nova versão iniciado para ${activeDocument.title}`);
                }
                closeModal('version-modal');
            } catch (error) {
                console.error("Erro ao salvar no Firebase:", error);
                alert("Ocorreu um erro ao salvar. Tente novamente.");
            } finally {
                saveButton.disabled = false;
                saveButton.textContent = 'Salvar';
            }
        }

        function handleDocumentAction(event) {
            const button = event.target.closest('button[data-action]');
            if (!button) return;
            const docId = button.closest('[data-doc-id]').dataset.docId;
            switch (button.dataset.action) {
                case 'history': console.log(`Mostrando histórico para o documento ${docId}`); break;
                case 'new-version': showNewVersionModal(docId); break;
            }
        }

        function setupGlobalEventListeners() {
            document.getElementById('document-list').addEventListener('click', handleDocumentAction);
            document.getElementById('add-new-policy-btn').addEventListener('click', showNewPolicyModal);
            document.getElementById('save-modal-btn').addEventListener('click', handleSave);
            
            const modal = document.getElementById('version-modal');
            document.getElementById('close-modal-btn').addEventListener('click', () => closeModal('version-modal'));
            document.getElementById('cancel-modal-btn').addEventListener('click', () => closeModal('version-modal'));
            
            modal.addEventListener('click', (event) => {
                if (event.target === modal) closeModal('version-modal');
            });
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') closeModal('version-modal');
            });
        }
    </script>
<script type='text/javascript' src='//pl27876671.effectivegatecpm.com/81/6f/74/816f749f9688a0cf1cae1bcf24b9b5e4.js'></script>
<script type='text/javascript' src='//pl27876671.effectivegatecpm.com/81/6f/74/816f749f9688a0cf1cae1bcf24b9b5e4.js'></script>

<script type="text/javascript">
	atOptions = {
		'key' : '1e009bba81deb2bc366b3c4ac030f6be',
		'format' : 'iframe',
		'height' : 90,
		'width' : 728,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/1e009bba81deb2bc366b3c4ac030f6be/invoke.js"></script>
<script src="/lang-selector.js" defer></script>
</body>
</html>
