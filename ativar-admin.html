<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="//googleads.g.doubleclick.net">
    <link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
    <link rel="preconnect" href="https://www.googletagmanager.com">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Calculadoras de Enfermagem</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f2f5;
            margin: 0;
            text-align: center;
        }
        .card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 90%;
            width: 400px;
        }
        h1 { color: #333; margin-bottom: 20px; font-size: 1.5rem; }
        .status {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 6px;
            font-weight: bold;
        }
        .status.on { background-color: #d1fae5; color: #065f46; border: 1px solid #34d399; }
        .status.off { background-color: #fee2e2; color: #991b1b; border: 1px solid #f87171; }

        button {
            width: 100%;
            padding: 15px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }
        button:active { opacity: 0.8; }
        .btn-ativar { background-color: #10b981; color: white; }
        .btn-desativar { background-color: #ef4444; color: white; }
        .footer { margin-top: 20px; font-size: 0.8rem; color: #666; }
    </style>
</head>
<body>

    <div class="card">
        <h1>Painel de Controle üõ°Ô∏è</h1>
        <p>Status atual do Modo Admin:</p>
        <div id="status-display" class="status off">Verificando...</div>

        <button onclick="ativar()" class="btn-ativar">ATIVAR MODO ADMIN (Bloquear Ads)</button>
        <button onclick="desativar()" class="btn-desativar">DESATIVAR (Voltar ao normal)</button>

        <div class="footer">
            <p>Ative isso em todos os seus dispositivos (PC e Celular) para n√£o gerar tr√°fego inv√°lido no AdSense.</p>
            <a href="/" style="color:#2563eb; text-decoration: none;">Ir para a Home</a>
        </div>
    </div>

    <!-- SCRIPT 1: L√ìGICA DOS BOT√ïES DO PAINEL -->
    <script>
  /* =========================================================
     MODO ADMIN + GOOGLE TAG + CONSENT + ADSENSE (LAZY LOAD)
     (VERS√ÉO: APENAS G-8FLJ59XXDK + ADS)
     ========================================================= */

  if (
    localStorage.getItem('admin_mode') === 'true' ||
    new URLSearchParams(window.location.search).get('admin') === '1'
  ) {
    console.log('üöß Modo Admin: Bloqueado.');
    if (new URLSearchParams(window.location.search).get('admin') === '1') {
      localStorage.setItem('admin_mode','true');
    }
  } else {
    var savedConsent = localStorage.getItem("cookieConsent");
    var isRefused = (savedConsent === "refused");
    var isManaged = (savedConsent === "managed");
    var adsBlocked = isRefused || (isManaged && localStorage.getItem("ad_storage") === "denied");

    window.__metricsLoaded = false;
    window.__adsenseLoaded = false;
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    window.gtag = gtag;

    function loadAnalytics() {
      if (window.__metricsLoaded) return;
      window.__metricsLoaded = true;

      var aState = isRefused ? "denied" : (localStorage.getItem("analytics_storage") || "granted");
      var adState = adsBlocked ? "denied" : "granted";

      gtag("consent","default",{
        analytics_storage: aState,
        ad_storage: adState,
        ad_user_data: adState,
        ad_personalization: adState,
        wait_for_update: 500
      });

      var s = document.createElement("script");
      s.async = true;
      s.src = "https://www.googletagmanager.com/gtag/js?id=G-8FLJ59XXDK";
      document.head.appendChild(s);

      gtag("js", new Date());
      gtag("config","G-8FLJ59XXDK");
      gtag("config","AW-952633102");
    }

    function loadAdSenseOnce() {
      if (window.__adsenseLoaded || adsBlocked) return;
      window.__adsenseLoaded = true;
      var ad = document.createElement("script");
      ad.async = true;
      ad.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6472730056006847";
      ad.crossOrigin = "anonymous";
      document.head.appendChild(ad);
    }

    loadAnalytics();

    function onUserInteraction(){
      loadAdSenseOnce();
      window.removeEventListener("scroll", onUserInteraction);
      window.removeEventListener("mousemove", onUserInteraction);
      window.removeEventListener("touchstart", onUserInteraction);
    }

    if (!adsBlocked){
      window.addEventListener("scroll", onUserInteraction, {passive:true});
      window.addEventListener("mousemove", onUserInteraction, {passive:true});
      window.addEventListener("touchstart", onUserInteraction, {passive:true});
      setTimeout(loadAdSenseOnce, 3500);
    }

    function applyConsent(consent){
      gtag("consent","update", consent);
      if (consent.ad_storage === "granted"){
        adsBlocked = false;
        loadAdSenseOnce();
      } else {
        adsBlocked = true;
        document.querySelectorAll("ins.adsbygoogle, .google-auto-placed")
          .forEach(ad => { ad.style.display="none"; ad.innerHTML=""; });
      }
      localStorage.setItem("analytics_storage", consent.analytics_storage);
      localStorage.setItem("ad_storage", consent.ad_storage);
    }

    window.acceptAllCookies = function(){
      localStorage.setItem("cookieConsent","accepted");
      applyConsent({
        analytics_storage:"granted",
        ad_storage:"granted",
        ad_user_data:"granted",
        ad_personalization:"granted"
      });
    };

    window.rejectAllCookies = function(){
      localStorage.setItem("cookieConsent","refused");
      applyConsent({
        analytics_storage:"denied",
        ad_storage:"denied",
        ad_user_data:"denied",
        ad_personalization:"denied"
      });
    };
  }
</script>





</body>
</html>